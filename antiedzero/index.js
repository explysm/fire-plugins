(function(o,h,c,f,r,E,L,A,m,y,P){"use strict";const D=c.findByProps("getChannel","getDMFromUserId"),I=c.findByProps("_channelMessages"),k=c.findByProps("getMessage","getMessages");function x(a){return h.before("dispatch",r.FluxDispatcher,function(s){if(o.isEnabled)try{const n=s[0];if(!n||!n.type)return;if(n.type==="MESSAGE_DELETE"){if(n.otherPluginBypass)return;const e=I.get(n.channelId)?.get(n.id);if(!e?.author?.id||!e.author.username||e?.author?.bot&&e?.flags==64||e.author.bot||!e.content&&!e.attachments?.length&&!e.embeds?.length)return;const t=a.get(n.id);if(t?.stage===2){a.size>=100&&(a=new Map);return}if(t?.stage===1)return t.stage=2,t.message||s;const l=D.getChannel(e.channel_id||n.channelId)?.guild_id;return n.message={...e,content:e.content,channel_id:e.channel_id||n.channelId,guild_id:l,message_reference:e?.message_reference||e?.messageReference||null,flags:64},n.type="MESSAGE_UPDATE",n.channelId=e.channel_id||n.channelId,n.optimistic=!1,n.sendMessageOptions={},n.isPushNotification=!1,a.set(n.id,{message:s,stage:1}),s}if(n.type==="MESSAGE_UPDATE"){if(n.otherPluginBypass)return;const e=n.message;if(!e||e.author?.bot)return;const t=e.channel_id||n.channelId,l=e.id||n.id,i=k.getMessage(t,l)||I.get(t)?.get(l);if(!i?.author?.id||!i.author.username||!i.content&&!i.attachments?.length&&!i.embeds?.length||!e.content||e.content===i.content)return;try{const u=c.findByProps("getCurrentUser").getCurrentUser();if(u&&i.author.id===u.id)return s}catch(u){console.error("[ANTIED Zero] Failed to check current user, functionality may be impacted.",u)}let d="`[ EDITED ]`\n\n";return n.message={...e,content:`${i.content} ${d}${e.content}`,guild_id:D.getChannel(t)?.guild_id??e.guild_id,edited_timestamp:"invalid_timestamp",message_reference:e?.message_reference||i?.messageReference||null},s}}catch(n){f.showToast("[ANTIED Zero] FluxDispatcher crash \u2013 check logs"),console.error(`[ANTIED Zero] Flux patch
`,n)}})}const Z=c.findByProps("sendMessage","startEditMessage");function G(){return h.before("startEditMessage",Z,function(a){if(!o.isEnabled)return;const s=R("`[ EDITED ]`\n\n"),n=new RegExp(s,"gmi"),[,,e]=a,t=e.split(n),l=t[t.length-1];a[2]=l})}const S=c.findByProps("openLazy","hideActionSheet"),z=c.findByProps("getMessage","getMessages"),Q=c.findByProps("getChannel","getDMFromUserId"),V=c.findByProps("_channelMessages"),{ActionSheetRow:M}=c.findByProps("ActionSheetRow");function v(a){return a?.props?.label?.toLowerCase?.()=="reply"}function j(){return h.before("openLazy",S,function([a,s,n]){if(o.isEnabled)try{const e=n?.message;if(s!=="MessageLongPressActionSheet"||!e)return;a.then(function(t){const l=h.after("default",t,function(i,d){try{r.React.useEffect(function(){return function(){l()}},[]);const u=L.findInReactTree(d,function(_){return _?.find?.(v)});if(!u)return d;const ae=Math.max(u.findIndex(v),u.length-1);let g=null;if(e?.channel_id&&e?.id&&(g=z.getMessage(e?.channel_id,e?.id),g||(g=V.get(e?.channel_id)?.get(e?.id))),!g)return d;const ie=R("`[ EDITED ]`\n\n"),$=new RegExp(ie,"gmi");if($.test(e.content)){const _=ae||1;u.splice(_,0,r.React.createElement(M,{label:"Remove Edit History",subLabel:"Added by Antied Zero",icon:r.React.createElement(M.Icon,{source:E.getAssetIDByName("ic_edit_24px")}),onPress:function(){const U=e?.content?.split($),se=U[U.length-1];r.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...e,message_reference:e?.message_reference||e?.messageReference||null,content:`${se}`,guild_id:Q.getChannel(g.channel_id).guild_id},otherPluginBypass:!0}),S.hideActionSheet(),f.showToast("History Removed",E.getAssetIDByName("ic_edit_24px"))}}))}}catch(u){f.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet:Component Patch
`,u)}})})}catch(e){f.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet Patch
`,e)}})}const w=c.findByStoreName("UserStore"),{ScrollView:O,View:T,Image:B}=y.General,{FormArrow:H,FormRow:p,FormSection:b,FormDivider:C}=y.Forms,W=[{name:"Angel",role:"Author & Maintainer",uuid:"692632336961110087"}],K=[{name:"Moodle",role:"Quality Assurance",uuid:"807170846497570848"},{name:"Rairof",role:"Quality Assurance",uuid:"923212189123346483"},{name:"Catinette",role:"Quality Assurance",uuid:"1302022854740807730"},{name:"Win8.1VMUser",role:"Quality Assurance",uuid:"793935599702507542"}],q=[{label:"Source Code",url:"https://github.com/angelix1/MP"},{label:"Tip via PayPal",url:"https://paypal.me/alixymizuki"},{label:"Buy me a Ko-fi",url:"https://ko-fi.com/angel_wolf"}];function J(){A.useProxy(m.storage);const a=function(t){return r.url.openURL(t).catch(function(){})},s=function(t){return w?.getUser(t)||Object.values(w?.getUsers()).find(function(l){return l.id===t})||null},n=function(t){return s(t)?.getAvatarURL?.()?.replace("webp","png")||null},e=function(t){return r.React.createElement(B,{source:{uri:t},style:{width:40,height:40,borderRadius:20}})};return r.React.createElement(r.React.Fragment,null,r.React.createElement(O,null,r.React.createElement(b,{title:"Developers"},W.map(function(t,l){const i=n(t?.uuid);return r.React.createElement(p,{key:l,label:t.name,subLabel:t.role,leading:i?e(i):null})})),r.React.createElement(b,{title:"Testers"},K.map(function(t,l){const i=n(t?.uuid);return r.React.createElement(p,{key:l,label:t.name,subLabel:t.role,leading:i?e(i):null})})),r.React.createElement(C,null),r.React.createElement(b,{title:"Support & Source"},r.React.createElement(T,{style:{margin:50}},q.map(function(t,l){let i=t.icon?t.icon?.startsWith("https")?r.React.createElement(B,{source:{uri:t.icon},style:{width:120,height:40}}):r.React.createElement(p.Icon,{source:E.getAssetIDByName(t.icon)}):null;return r.React.createElement(p,{key:l,label:t.label,leading:i,trailing:r.React.createElement(H,null),onPress:function(){return a(t.url)}})}))),r.React.createElement(C,null),r.React.createElement(T,{style:{height:40}})))}const{FormRow:F}=y.Forms;function X(){A.useProxy(m.storage);const a=r.NavigationNative.useNavigation(),s=function(){a.push("VendettaCustomPage",{title:"Credits & Support",render:function(){return r.React.createElement(J)}})};return r.React.createElement(r.React.Fragment,null,r.React.createElement(F,{label:"CREDITS",subLabel:"See the people behind the plugin and ways to support its development.",onPress:s,trailing:r.React.createElement(F.Icon,{source:E.getAssetIDByName("ic_arrow_right")})}))}const R=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};o.isEnabled=!1;const Y=new Map;let N;const ee=[[x,[Y]],[j,[]],[G,[]]],te=function(){return ee.forEach(function([a,s]){return a(...s)})},ne="https://angelix1.github.io/static_list/antied/list.json";N=te();var re={onLoad:async function(){const a=await P.fetchDB(ne);P.selfDelete(a,15),o.isEnabled=!0},onUnload:function(){o.isEnabled=!1,N?.()},settings:X};return o.default=re,o.regexEscaper=R,Object.defineProperty(o,"__esModule",{value:!0}),o})({},vendetta.patcher,vendetta.metro,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.storage,vendetta.plugin,vendetta.ui.components,bl);
