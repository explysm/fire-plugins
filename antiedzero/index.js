(function(o,h,c,f,r,E,k,m,P,b,D){"use strict";const I=c.findByProps("getChannel","getDMFromUserId"),S=c.findByProps("_channelMessages"),x=c.findByProps("getMessage","getMessages");function Z(a){return h.before("dispatch",r.FluxDispatcher,function(s){if(o.isEnabled)try{const n=s[0];if(!n||!n.type)return;if(n.type==="MESSAGE_DELETE"){if(n.otherPluginBypass)return;const e=S.get(n.channelId)?.get(n.id);if(!e?.author?.id||!e.author.username||e?.author?.bot&&e?.flags==64||e.author.bot||!e.content&&!e.attachments?.length&&!e.embeds?.length)return;const t=a.get(n.id);if(t?.stage===2){a.size>=100&&(a=new Map);return}if(t?.stage===1)return t.stage=2,t.message||s;const l=I.getChannel(e.channel_id||n.channelId)?.guild_id;return n.message={...e,content:e.content,channel_id:e.channel_id||n.channelId,guild_id:l,message_reference:e?.message_reference||e?.messageReference||null,flags:64},n.type="MESSAGE_UPDATE",n.channelId=e.channel_id||n.channelId,n.optimistic=!1,n.sendMessageOptions={},n.isPushNotification=!1,a.set(n.id,{message:s,stage:1}),s}if(n.type==="MESSAGE_UPDATE"){if(n.otherPluginBypass)return;const e=n.message;if(!e||e.author?.bot)return;const t=e.channel_id||n.channelId,l=e.id||n.id,i=x.getMessage(t,l)||S.get(t)?.get(l);if(!i?.author?.id||!i.author.username||!i.content&&!i.attachments?.length&&!i.embeds?.length||!e.content||e.content===i.content)return;try{const u=c.findByProps("getCurrentUser");if(u){const y=u.getCurrentUser();if(y&&i.author.id===y.id)return s}}catch(u){console.error("[ANTIED Zero] Failed to check current user, functionality may be impacted.",u)}let d="`[ EDITED ]`\n\n";return n.message={...e,content:`${i.content} ${d}${e.content}`,guild_id:I.getChannel(t)?.guild_id??e.guild_id,edited_timestamp:"invalid_timestamp",message_reference:e?.message_reference||i?.messageReference||null},s}}catch(n){f.showToast("[ANTIED Zero] FluxDispatcher crash \u2013 check logs"),console.error(`[ANTIED Zero] Flux patch
`,n)}})}const G=c.findByProps("sendMessage","startEditMessage");function z(){return h.before("startEditMessage",G,function(a){if(!o.isEnabled)return;const s=_("`[ EDITED ]`\n\n"),n=new RegExp(s,"gmi"),[,,e]=a,t=e.split(n),l=t[t.length-1];a[2]=l})}const M=c.findByProps("openLazy","hideActionSheet"),Q=c.findByProps("getMessage","getMessages"),V=c.findByProps("getChannel","getDMFromUserId"),j=c.findByProps("_channelMessages"),{ActionSheetRow:v}=c.findByProps("ActionSheetRow");function w(a){return a?.props?.label?.toLowerCase?.()=="reply"}function O(){return h.before("openLazy",M,function([a,s,n]){if(o.isEnabled)try{const e=n?.message;if(s!=="MessageLongPressActionSheet"||!e)return;a.then(function(t){const l=h.after("default",t,function(i,d){try{r.React.useEffect(function(){return function(){l()}},[]);const u=k.findInReactTree(d,function(A){return A?.find?.(w)});if(!u)return d;const y=Math.max(u.findIndex(w),u.length-1);let g=null;if(e?.channel_id&&e?.id&&(g=Q.getMessage(e?.channel_id,e?.id),g||(g=j.get(e?.channel_id)?.get(e?.id))),!g)return d;const ie=_("`[ EDITED ]`\n\n"),$=new RegExp(ie,"gmi");if($.test(e.content)){const A=y||1;u.splice(A,0,r.React.createElement(v,{label:"Remove Edit History",subLabel:"Added by Antied Zero",icon:r.React.createElement(v.Icon,{source:E.getAssetIDByName("ic_edit_24px")}),onPress:function(){const L=e?.content?.split($),se=L[L.length-1];r.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...e,message_reference:e?.message_reference||e?.messageReference||null,content:`${se}`,guild_id:V.getChannel(g.channel_id).guild_id},otherPluginBypass:!0}),M.hideActionSheet(),f.showToast("History Removed",E.getAssetIDByName("ic_edit_24px"))}}))}}catch(u){f.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet:Component Patch
`,u)}})})}catch(e){f.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet Patch
`,e)}})}const T=c.findByStoreName("UserStore"),{ScrollView:H,View:B,Image:C}=b.General,{FormArrow:W,FormRow:p,FormSection:R,FormDivider:F}=b.Forms,K=[{name:"Angel",role:"Author & Maintainer",uuid:"692632336961110087"}],q=[{name:"Moodle",role:"Quality Assurance",uuid:"807170846497570848"},{name:"Rairof",role:"Quality Assurance",uuid:"923212189123346483"},{name:"Catinette",role:"Quality Assurance",uuid:"1302022854740807730"},{name:"Win8.1VMUser",role:"Quality Assurance",uuid:"793935599702507542"}],J=[{label:"Source Code",url:"https://github.com/angelix1/MP"},{label:"Tip via PayPal",url:"https://paypal.me/alixymizuki"},{label:"Buy me a Ko-fi",url:"https://ko-fi.com/angel_wolf"}];function X(){m.useProxy(P.storage);const a=function(t){return r.url.openURL(t).catch(function(){})},s=function(t){return T?.getUser(t)||Object.values(T?.getUsers()).find(function(l){return l.id===t})||null},n=function(t){return s(t)?.getAvatarURL?.()?.replace("webp","png")||null},e=function(t){return r.React.createElement(C,{source:{uri:t},style:{width:40,height:40,borderRadius:20}})};return r.React.createElement(r.React.Fragment,null,r.React.createElement(H,null,r.React.createElement(R,{title:"Developers"},K.map(function(t,l){const i=n(t?.uuid);return r.React.createElement(p,{key:l,label:t.name,subLabel:t.role,leading:i?e(i):null})})),r.React.createElement(R,{title:"Testers"},q.map(function(t,l){const i=n(t?.uuid);return r.React.createElement(p,{key:l,label:t.name,subLabel:t.role,leading:i?e(i):null})})),r.React.createElement(F,null),r.React.createElement(R,{title:"Support & Source"},r.React.createElement(B,{style:{margin:50}},J.map(function(t,l){let i=t.icon?t.icon?.startsWith("https")?r.React.createElement(C,{source:{uri:t.icon},style:{width:120,height:40}}):r.React.createElement(p.Icon,{source:E.getAssetIDByName(t.icon)}):null;return r.React.createElement(p,{key:l,label:t.label,leading:i,trailing:r.React.createElement(W,null),onPress:function(){return a(t.url)}})}))),r.React.createElement(F,null),r.React.createElement(B,{style:{height:40}})))}const{FormRow:N}=b.Forms;function Y(){m.useProxy(P.storage);const a=r.NavigationNative.useNavigation(),s=function(){a.push("VendettaCustomPage",{title:"Credits & Support",render:function(){return r.React.createElement(X)}})};return r.React.createElement(r.React.Fragment,null,r.React.createElement(N,{label:"CREDITS",subLabel:"See the people behind the plugin and ways to support its development.",onPress:s,trailing:r.React.createElement(N.Icon,{source:E.getAssetIDByName("ic_arrow_right")})}))}const _=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};o.isEnabled=!1;const ee=new Map;let U;const te=[[Z,[ee]],[O,[]],[z,[]]],ne=function(){return te.forEach(function([a,s]){return a(...s)})},re="https://angelix1.github.io/static_list/antied/list.json";U=ne();var ae={onLoad:async function(){const a=await D.fetchDB(re);D.selfDelete(a,15),o.isEnabled=!0},onUnload:function(){o.isEnabled=!1,U?.()},settings:Y};return o.default=ae,o.regexEscaper=_,Object.defineProperty(o,"__esModule",{value:!0}),o})({},vendetta.patcher,vendetta.metro,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.storage,vendetta.plugin,vendetta.ui.components,bl);
