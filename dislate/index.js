(function(R,E,y,a,L,$,l,c,V,k,J,Y,f,d){"use strict";const x=y.findByProps("openLazy","hideActionSheet"),M=y.findByProps("ActionSheetRow")?.ActionSheetRow??c.Forms.FormRow,q=y.findByStoreName("MessageStore"),X=y.findByStoreName("ChannelStore"),W=`
`,Q=a.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:$.semanticColors.INTERACTIVE_NORMAL}});let A=[];function Z(){return L.before("openLazy",x,function([e,n,o]){const i=o?.message;n!=="MessageLongPressActionSheet"||!i||e.then(function(r){const s=L.after("default",r,function(H,ke){a.React.useEffect(function(){return function(){s()}},[]);const b=V.findInReactTree(ke,function(h){return h?.[0]?.type?.name==="ActionSheetRow"});if(!b)return;const xe=Math.max(b.findIndex(function(h){return h.props.message===a.i18n.Messages.MARK_UNREAD}),0),p=q.getMessage(i.channel_id,i.id);if(!p?.content&&!i.content)return;const S=p?.id??i.id,C=p?.content??i.content,v=A.find(function(h){return Object.keys(h)[0]===S},"cache object"),N=v?"Revert":"Translate",z=N==="Translate"?l.getAssetIDByName("LanguageIcon"):l.getAssetIDByName("ic_highlight"),Me=async function(){x.hideActionSheet();try{const T=t.target_lang,P=N==="Translate",Be=t.immersive_enabled;if(!p)return;const De=/<(a?):\w+:\d+>|<@!?\d+>|<#\d+>/g,_=[],Oe=C.replace(De,function(m){return _.push(m),` [[${_.length-1}]] `});var h;h=await h(Oe,void 0,T,!P);let I=h.text;_.forEach(function(m,Fe){const Ue=new RegExp(`\\[\\[\\s*${Fe}\\s*\\]\\]`,"g");I=I.replace(Ue,m)});const Ge=P?Be?`${C}${W}${I.trim()} \`[${T?.toLowerCase()}]\``:`${I.trim()} \`[${T?.toLowerCase()}]\``:v[S];a.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{id:S,channel_id:p.channel_id,guild_id:X.getChannel(p.channel_id)?.guild_id,content:Ge},log_edit:!1,otherPluginBypass:!0}),P?A.unshift({[S]:C}):A=A.filter(function(m){return m!==v},"cached data override")}catch(T){d.showToast("Failed to translate message. Please check Debug Logs for more info.",l.getAssetIDByName("Small")),k.logger.error(T)}};b.splice(xe,0,a.React.createElement(M,{label:`${N} Message`,icon:a.React.createElement(M.Icon,{source:z,IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{resizeMode:"cover",style:Q.iconComponent,source:z})}}),onPress:Me}))})})})}var ee=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),B=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),te=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({});const D={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},ae={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},ne="https://deeplx.mingming.dev/translate";var re={translate:async function(e,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:e};const r=await(await fetch(ne,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,source_lang:n,target_lang:o})})).json();if(r.code!==200)throw Error(`Failed to translate text from DeepL: ${r.message}`);return{source_lang:n,text:r.data}}catch(r){throw Error(`Failed to fetch from DeepL: ${r}`)}}},oe={translate:async function(e,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:e};const r="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:n,tl:o,dt:"t",dj:"1",source:"input",q:e}),s=await(await fetch(r)).json();return{source_lang:n,text:s.sentences.map(function(H){return H.trans}).join("")}}catch(r){throw Error(`Failed to fetch from Google Translate: ${r}`)}}};const ie="https://openrouter.ai/api/v1/chat/completions";var se={translate:async function(e,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:e};if(!t.openRouterApiKey)throw new Error("OpenRouter API Key is not set in settings.");const r=t.openRouterModel||"openai/gpt-3.5-turbo",s=await(await fetch(ie,{method:"POST",headers:{Authorization:`Bearer ${t.openRouterApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,messages:[{role:"system",content:`You are a highly accurate language translator. Translate the user's message from ${n} to ${o}. Only return the translated text, without any additional conversational filler.`},{role:"user",content:e}]})})).json();if(s.choices&&s.choices.length>0&&s.choices[0].message)return{source_lang:n,text:s.choices[0].message.content.trim()};throw new Error(`OpenRouter translation failed: ${s.error?.message||"Unknown error"}`)}catch(r){throw new Error(`Failed to fetch from OpenRouter: ${r instanceof Error?r.message:String(r)}`)}}};const le="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";var ce={translate:async function(e,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:e};if(!t.googleAIApiKey)throw new Error("Google AI API Key is not set in settings.");const r=t.googleAIModel||"gemini-pro",s=await(await fetch(`${le}?key=${t.googleAIApiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Translate the following text from ${n} to ${o}. Only return the translated text, without any additional conversational filler.

${e}`}]}]})})).json();if(s.candidates&&s.candidates.length>0&&s.candidates[0].content?.parts.length>0)return{source_lang:n,text:s.candidates[0].content.parts[0].text.trim()};throw new Error(`Google AI translation failed: ${s.promptFeedback?.blockReason||s.error?.message||"Unknown error"}`)}catch(r){throw new Error(`Failed to fetch from Google AI: ${r instanceof Error?r.message:String(r)}`)}}};const ue="https://api.openai.com/v1/chat/completions";var ge={translate:async function(e,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:e};if(!t.chatGPTApiKey)throw new Error("ChatGPT API Key is not set in settings.");const r=t.chatGPTModel||"gpt-3.5-turbo",s=await(await fetch(ue,{method:"POST",headers:{Authorization:`Bearer ${t.chatGPTApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,messages:[{role:"system",content:`You are a highly accurate language translator. Translate the user's message from ${n} to ${o}. Only return the translated text, without any additional conversational filler.`},{role:"user",content:e}]})})).json();if(s.choices&&s.choices.length>0&&s.choices[0].message)return{source_lang:n,text:s.choices[0].message.content.trim()};throw new Error(`ChatGPT translation failed: ${s.error?.message||"Unknown error"}`)}catch(r){throw new Error(`Failed to fetch from ChatGPT: ${r instanceof Error?r.message:String(r)}`)}}};const he=E.storage,de={0:re.translate,1:oe.translate,2:se.translate,3:ce.translate,4:ge.translate},fe=async function(e,n="auto",o,i=!1){const r=de[he.translator];if(!r)throw new Error("No translator selected or invalid translator ID.");return r(e,n,o,i)},pe=y.findByProps("sendBotMessage"),ye=Object.entries(D).map(function([e,n]){return{name:e,displayName:e,value:n}});function Te(){return J.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:te.CHAT,inputType:ee.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:B.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:B.STRING,choices:[...ye],required:!0}],async execute(e,n){const[o,i]=e;try{var r=await fe(o.value,void 0,i.value);return await new Promise(function(s){return Y.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(c.Codeblock,null,r.text),confirmText:"Yep, send it!",onConfirm:function(){return s({content:r.text})},cancelText:"Nope, don't send it"})})}catch(s){return k.logger.error(s),pe.sendBotMessage(n.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}}})}const{FormRow:w}=c.Forms,{ScrollView:O}=a.ReactNative;function me(){f.useProxy(t);const[e,n]=a.React.useState("");return t.translator==0?a.React.createElement(O,{style:{flex:1}},a.React.createElement(c.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(o){n(o)}}),Object.entries(D).filter(function([o,i]){return o.toLowerCase().includes(e.toLowerCase())}).map(function([o,i]){return a.React.createElement(w,{label:o,trailing:function(){return a.React.createElement(w.Arrow,null)},onPress:function(){t.target_lang!=i&&(t.target_lang=i,d.showToast(`Saved ToLang to ${o}`,l.getAssetIDByName("check")))}})})):a.React.createElement(O,{style:{flex:1}},a.React.createElement(c.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(o){n(o)}}),Object.entries(ae).filter(function([o,i]){return o.toLowerCase().includes(e.toLowerCase())}).map(function([o,i]){return a.React.createElement(w,{label:o,trailing:function(){return a.React.createElement(w.Arrow,null)},onPress:function(){t.target_lang!=i&&(t.target_lang=i,d.showToast(`Saved ToLang to ${o}`,l.getAssetIDByName("check")))}})}))}const{FormRow:u}=c.Forms,{ScrollView:Re}=a.ReactNative;function Ae(){return f.useProxy(t),a.React.createElement(Re,{style:{flex:1}},a.React.createElement(u,{label:"DeepL",trailing:function(){return a.React.createElement(u.Arrow,null)},onPress:function(){t.translator!=0&&(t.translator=0,d.showToast("Saved Translator to DeepL",l.getAssetIDByName("check")))}}),a.React.createElement(u,{label:"Google Translate",trailing:function(){return a.React.createElement(u.Arrow,null)},onPress:function(){t.translator!=1&&(t.translator=1,d.showToast("Saved Translator to Google Translate",l.getAssetIDByName("check")))}}),a.React.createElement(u,{label:"OpenRouter",trailing:function(){return a.React.createElement(u.Arrow,null)},onPress:function(){t.translator!=2&&(t.translator=2,d.showToast("Saved Translator to OpenRouter",l.getAssetIDByName("check")))}}),a.React.createElement(u,{label:"Google AI",trailing:function(){return a.React.createElement(u.Arrow,null)},onPress:function(){t.translator!=3&&(t.translator=3,d.showToast("Saved Translator to Google AI",l.getAssetIDByName("check")))}}),a.React.createElement(u,{label:"ChatGPT",trailing:function(){return a.React.createElement(u.Arrow,null)},onPress:function(){t.translator!=4&&(t.translator=4,d.showToast("Saved Translator to ChatGPT",l.getAssetIDByName("check")))}}))}const{FormTextInput:G,FormRow:we}=c.Forms;function Se(){return f.useProxy(t),a.React.createElement(we,{label:"OpenRouter Settings"},a.React.createElement(G,{value:t.openRouterApiKey,onChange:function(e){return t.openRouterApiKey=e},placeholder:"Enter OpenRouter API Key",spellcheck:!1,autoCorrect:!1}),a.React.createElement(G,{value:t.openRouterModel,onChange:function(e){return t.openRouterModel=e},placeholder:"Enter OpenRouter Model (e.g., openai/gpt-3.5-turbo)",spellcheck:!1,autoCorrect:!1}))}const{FormTextInput:F,FormRow:Ie}=c.Forms;function Ee(){return f.useProxy(t),a.React.createElement(Ie,{label:"Google AI Settings"},a.React.createElement(F,{value:t.googleAIApiKey,onChange:function(e){return t.googleAIApiKey=e},placeholder:"Enter Google AI API Key",spellcheck:!1,autoCorrect:!1}),a.React.createElement(F,{value:t.googleAIModel,onChange:function(e){return t.googleAIModel=e},placeholder:"Enter Google AI Model (e.g., gemini-pro)",spellcheck:!1,autoCorrect:!1}))}const{FormTextInput:U,FormRow:be}=c.Forms;function Ce(){return f.useProxy(t),a.React.createElement(be,{label:"ChatGPT Settings"},a.React.createElement(U,{value:t.chatGPTApiKey,onChange:function(e){return t.chatGPTApiKey=e},placeholder:"Enter ChatGPT API Key",spellcheck:!1,autoCorrect:!1}),a.React.createElement(U,{value:t.chatGPTModel,onChange:function(e){return t.chatGPTModel=e},placeholder:"Enter ChatGPT Model (e.g., gpt-3.5-turbo)",spellcheck:!1,autoCorrect:!1}))}const{ScrollView:ve,Text:Ne}=a.ReactNative,{FormRow:g,FormSwitchRow:Pe}=c.Forms,_e=a.stylesheet.createThemedStyleSheet({subheaderText:{color:$.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:a.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),K=function(e){switch(e){case 0:return"DeepL";case 1:return"Google Translate";case 2:return"OpenRouter";case 3:return"Google AI";case 4:return"ChatGPT";default:return"Unknown"}};function Le(){const e=a.NavigationNative.useNavigation();return f.useProxy(t),a.React.createElement(ve,null,a.React.createElement(Pe,{label:"Immersive Translation",subLabel:"Display both original and translation",leading:a.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_chat_bubble_filled_24px")}),value:t.immersive_enabled??!0,onValueChange:function(n){t.immersive_enabled=n}}),a.React.createElement(g,{label:"Translate to",subLabel:t.target_lang?.toLowerCase(),leading:a.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_activity_24px")}),trailing:function(){return a.React.createElement(g.Arrow,null)},onPress:function(){return e.push("VendettaCustomPage",{title:"Translate to",render:me})}}),a.React.createElement(g,{label:"Translator",subLabel:K(t.translator),leading:a.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_locale_24px")}),trailing:function(){return a.React.createElement(g.Arrow,null)},onPress:function(){return e.push("VendettaCustomPage",{title:"Translator",render:Ae})}}),(t.translator===2||t.translator===3||t.translator===4)&&a.React.createElement(a.React.Fragment,null,a.React.createElement(g,{label:"AI Translator Settings",subLabel:"Configure API keys and models",leading:a.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_cog_24px")}),trailing:function(){return a.React.createElement(g.Arrow,null)},onPress:function(){let n;switch(t.translator){case 2:n=Se;break;case 3:n=Ee;break;case 4:n=Ce;break;default:return}e.push("VendettaCustomPage",{title:`${K(t.translator)} Settings`,render:n})}})),a.React.createElement(Ne,{style:_e.subheaderText,onPress:function(){return a.url.openURL("https://github.com/Rico040/bunny-plugins")}},`Build: (${E.manifest.hash.substring(0,7)})`))}const t=E.storage;t.target_lang=t.target_lang??"en",t.translator=t.translator??1,t.immersive_enabled=t.immersive_enabled??!0;let j=[];var $e={onLoad:function(){return j=[Z(),Te()]},onUnload:function(){for(const e of j)e()},settings:Le};return R.default=$e,R.settings=t,Object.defineProperty(R,"__esModule",{value:!0}),R})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
