(function($e,k,a,pe,Be,fe,F,j,Ve,Kt,tt){"use strict";const L={DEFAULT_APP_NAME:"Music",DEFAULT_TIME_INTERVAL:5,APPLICATION_ID:"1368513179272871956",MIN_UPDATE_INTERVAL:3,MAX_RETRY_ATTEMPTS:3,RETRY_DELAY:5e3,SERVICES:{lastfm:{name:"Last.fm",baseUrl:"https://ws.audioscrobbler.com/2.0",requiresApiKey:!0,requiresToken:!1},librefm:{name:"Libre.fm",baseUrl:"https://libre.fm/api",requiresApiKey:!0,requiresToken:!1},listenbrainz:{name:"ListenBrainz",baseUrl:"https://api.listenbrainz.org/1",requiresApiKey:!1,requiresToken:!0},trakt:{name:"Trakt",baseUrl:"https://api.trakt.tv",requiresApiKey:!0,requiresToken:!1}},DEFAULT_HEADERS:{},DEFAULT_COVER_HASHES:["2a96cbd8b46e442fc41c2b86b821562f"],DEFAULT_SETTINGS:{username:"",apiKey:"",appName:"Music",timeInterval:5,showTimestamp:!0,listeningTo:!0,showLargeText:!0,ignoreYouTubeMusic:!1,verboseLogging:!1,service:void 0,librefmUsername:"",librefmApiKey:"",listenbrainzUsername:"",listenbrainzToken:"",traktUsername:"",traktClientId:"",traktAccessToken:""},API_ERROR_CODES:{2:"Invalid service",3:"Invalid method",4:"Invalid format",5:"Invalid parameters",6:"Invalid resource specified",7:"Invalid session key",8:"Invalid API key",9:"Invalid session",10:"Invalid API signature",11:"Service offline",13:"Invalid method signature supplied",16:"Service temporarily unavailable",26:"Suspended API key",29:"Rate limit exceeded"}};function he(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dt(t,r){for(var n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function ye(t,r,n){return r&&dt(t.prototype,r),n&&dt(t,n),t}pe.findByProps("SET_ACTIVITY")?.SET_ACTIVITY;const gt=pe.findByProps("getAssetIds"),pt=pe.findByStoreName("SelfPresenceStore"),ht=pe.findByStoreName("UserStore"),yt=function(...t){return console.log("[Activity]",...t)},Wt=function(...t){return console.error("[Activity] Error:",...t)},_e=function(...t){try{console.log("[Activity] Verbose:",...t)}catch{console.log("[Activity] Verbose:",...t)}};function rt(){return yt("Clearing Discord activity"),bt(null)}function bt(t){K.pluginStopped&&(_e("Plugin is stopped, clearing activity"),it(),t=null),K.lastActivity=t,_e("Dispatching activity update:",t?"Setting activity":"Clearing activity"),a.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:t,pid:2312,socketId:"Multi-Service-Scrobbler@Vendetta"}),yt(t?`Activity set: ${t.details} - ${t.state}`:"Activity cleared")}async function Xt(t,r=L.APPLICATION_ID){if(!t?.length)return _e("No assets to fetch"),[];try{if(!gt)return _e("AssetManager not found, skipping fetch"),[];_e(`Fetching ${t.length} asset(s):`,t);const n=await gt.fetchAssetIds(r,t);return _e(`Successfully fetched ${n.length} asset(s)`),n}catch(n){return Wt("Failed to fetch assets:",n),[]}}var R={},vt;function Qt(){if(vt)return R;vt=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),g=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),W=Symbol.for("react.activity"),X=Symbol.iterator;function N(i){return i===null||typeof i!="object"?null:(i=X&&i[X]||i["@@iterator"],typeof i=="function"?i:null)}var ne={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},q=Object.assign,J={};function le(i,f,w){this.props=i,this.context=f,this.refs=J,this.updater=w||ne}le.prototype.isReactComponent={},le.prototype.setState=function(i,f){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,f,"setState")},le.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function T(){}T.prototype=le.prototype;function U(i,f,w){this.props=i,this.context=f,this.refs=J,this.updater=w||ne}var ae=U.prototype=new T;ae.constructor=U,q(ae,le.prototype),ae.isPureReactComponent=!0;var oe=Array.isArray;function Te(){}var $={H:null,A:null,T:null,S:null},We=Object.prototype.hasOwnProperty;function de(i,f,w){var E=w.ref;return{$$typeof:t,type:i,key:f,ref:E!==void 0?E:null,props:w}}function Le(i,f){return de(i.type,f,i.props)}function ze(i){return typeof i=="object"&&i!==null&&i.$$typeof===t}function V(i){var f={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(w){return f[w]})}var je=/\/+/g;function Ee(i,f){return typeof i=="object"&&i!==null&&i.key!=null?V(""+i.key):f.toString(36)}function Se(i){switch(i.status){case"fulfilled":return i.value;case"rejected":throw i.reason;default:switch(typeof i.status=="string"?i.then(Te,Te):(i.status="pending",i.then(function(f){i.status==="pending"&&(i.status="fulfilled",i.value=f)},function(f){i.status==="pending"&&(i.status="rejected",i.reason=f)})),i.status){case"fulfilled":return i.value;case"rejected":throw i.reason}}throw i}function ue(i,f,w,E,P){var O=typeof i;(O==="undefined"||O==="boolean")&&(i=null);var M=!1;if(i===null)M=!0;else switch(O){case"bigint":case"string":case"number":M=!0;break;case"object":switch(i.$$typeof){case t:case r:M=!0;break;case D:return M=i._init,ue(M(i._payload),f,w,E,P)}}if(M)return P=P(i),M=E===""?"."+Ee(i,0):E,oe(P)?(w="",M!=null&&(w=M.replace(je,"$&/")+"/"),ue(P,f,w,"",function(ke){return ke})):P!=null&&(ze(P)&&(P=Le(P,w+(P.key==null||i&&i.key===P.key?"":(""+P.key).replace(je,"$&/")+"/")+M)),f.push(P)),1;M=0;var se=E===""?".":E+":";if(oe(i))for(var Q=0;Q<i.length;Q++)E=i[Q],O=se+Ee(E,Q),M+=ue(E,f,w,O,P);else if(Q=N(i),typeof Q=="function")for(i=Q.call(i),Q=0;!(E=i.next()).done;)E=E.value,O=se+Ee(E,Q++),M+=ue(E,f,w,O,P);else if(O==="object"){if(typeof i.then=="function")return ue(Se(i),f,w,E,P);throw f=String(i),Error("Objects are not valid as a React child (found: "+(f==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":f)+"). If you meant to render a collection of children, use an array instead.")}return M}function we(i,f,w){if(i==null)return i;var E=[],P=0;return ue(i,E,"","",function(O){return f.call(w,O,P++)}),E}function Fe(i){if(i._status===-1){var f=i._result;f=f(),f.then(function(w){(i._status===0||i._status===-1)&&(i._status=1,i._result=w)},function(w){(i._status===0||i._status===-1)&&(i._status=2,i._result=w)}),i._status===-1&&(i._status=0,i._result=f)}if(i._status===1)return i._result.default;throw i._result}var Pe=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Xe={map:we,forEach:function(i,f,w){we(i,function(){f.apply(this,arguments)},w)},count:function(i){var f=0;return we(i,function(){f++}),f},toArray:function(i){return we(i,function(f){return f})||[]},only:function(i){if(!ze(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};return R.Activity=W,R.Children=Xe,R.Component=le,R.Fragment=n,R.Profiler=c,R.PureComponent=U,R.StrictMode=s,R.Suspense=v,R.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,R.__COMPILER_RUNTIME={__proto__:null,c:function(i){return $.H.useMemoCache(i)}},R.cache=function(i){return function(){return i.apply(null,arguments)}},R.cacheSignal=function(){return null},R.cloneElement=function(i,f,w){if(i==null)throw Error("The argument must be a React element, but you passed "+i+".");var E=q({},i.props),P=i.key;if(f!=null)for(O in f.key!==void 0&&(P=""+f.key),f)!We.call(f,O)||O==="key"||O==="__self"||O==="__source"||O==="ref"&&f.ref===void 0||(E[O]=f[O]);var O=arguments.length-2;if(O===1)E.children=w;else if(1<O){for(var M=Array(O),se=0;se<O;se++)M[se]=arguments[se+2];E.children=M}return de(i.type,P,E)},R.createContext=function(i){return i={$$typeof:g,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null},i.Provider=i,i.Consumer={$$typeof:l,_context:i},i},R.createElement=function(i,f,w){var E,P={},O=null;if(f!=null)for(E in f.key!==void 0&&(O=""+f.key),f)We.call(f,E)&&E!=="key"&&E!=="__self"&&E!=="__source"&&(P[E]=f[E]);var M=arguments.length-2;if(M===1)P.children=w;else if(1<M){for(var se=Array(M),Q=0;Q<M;Q++)se[Q]=arguments[Q+2];P.children=se}if(i&&i.defaultProps)for(E in M=i.defaultProps,M)P[E]===void 0&&(P[E]=M[E]);return de(i,O,P)},R.createRef=function(){return{current:null}},R.forwardRef=function(i){return{$$typeof:y,render:i}},R.isValidElement=ze,R.lazy=function(i){return{$$typeof:D,_payload:{_status:-1,_result:i},_init:Fe}},R.memo=function(i,f){return{$$typeof:C,type:i,compare:f===void 0?null:f}},R.startTransition=function(i){var f=$.T,w={};$.T=w;try{var E=i(),P=$.S;P!==null&&P(w,E),typeof E=="object"&&E!==null&&typeof E.then=="function"&&E.then(Te,Pe)}catch(O){Pe(O)}finally{f!==null&&w.types!==null&&(f.types=w.types),$.T=f}},R.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},R.use=function(i){return $.H.use(i)},R.useActionState=function(i,f,w){return $.H.useActionState(i,f,w)},R.useCallback=function(i,f){return $.H.useCallback(i,f)},R.useContext=function(i){return $.H.useContext(i)},R.useDebugValue=function(){},R.useDeferredValue=function(i,f){return $.H.useDeferredValue(i,f)},R.useEffect=function(i,f){return $.H.useEffect(i,f)},R.useEffectEvent=function(i){return $.H.useEffectEvent(i)},R.useId=function(){return $.H.useId()},R.useImperativeHandle=function(i,f,w){return $.H.useImperativeHandle(i,f,w)},R.useInsertionEffect=function(i,f){return $.H.useInsertionEffect(i,f)},R.useLayoutEffect=function(i,f){return $.H.useLayoutEffect(i,f)},R.useMemo=function(i,f){return $.H.useMemo(i,f)},R.useOptimistic=function(i,f){return $.H.useOptimistic(i,f)},R.useReducer=function(i,f,w){return $.H.useReducer(i,f,w)},R.useRef=function(i){return $.H.useRef(i)},R.useState=function(i){return $.H.useState(i)},R.useSyncExternalStore=function(i,f,w){return $.H.useSyncExternalStore(i,f,w)},R.useTransition=function(){return $.H.useTransition()},R.version="19.2.4",R}var Ue={exports:{}};Ue.exports;var mt;function Zt(){return mt||(mt=1,function(t,r){process.env.NODE_ENV!=="production"&&function(){function n(e,o){Object.defineProperty(l.prototype,e,{get:function(){console.warn("%s(...) is deprecated in plain JavaScript React classes. %s",o[0],o[1])}})}function s(e){return e===null||typeof e!="object"?null:(e=Ut&&e[Ut]||e["@@iterator"],typeof e=="function"?e:null)}function c(e,o){e=(e=e.constructor)&&(e.displayName||e.name)||"ReactClass";var u=e+"."+o;Ot[u]||(console.error("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",o,e),Ot[u]=!0)}function l(e,o,u){this.props=e,this.context=o,this.refs=ut,this.updater=u||Dt}function g(){}function y(e,o,u){this.props=e,this.context=o,this.refs=ut,this.updater=u||Dt}function v(){}function C(e){return""+e}function D(e){try{C(e);var o=!1}catch{o=!0}if(o){o=console;var u=o.error,d=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return u.call(o,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",d),C(e)}}function W(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Ir?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case i:return"Fragment";case w:return"Profiler";case f:return"StrictMode";case M:return"Suspense";case se:return"SuspenseList";case $t:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case Xe:return"Portal";case P:return e.displayName||"Context";case E:return(e._context.displayName||"Context")+".Consumer";case O:var o=e.render;return e=e.displayName,e||(e=o.displayName||o.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Q:return o=e.displayName||null,o!==null?o:W(e.type)||"Memo";case ke:o=e._payload,e=e._init;try{return W(e(o))}catch{}}return null}function X(e){if(e===i)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===ke)return"<...>";try{var o=W(e);return o?"<"+o+">":"<...>"}catch{return"<...>"}}function N(){var e=_.A;return e===null?null:e.getOwner()}function ne(){return Error("react-stack-top-frame")}function q(e){if(Qe.call(e,"key")){var o=Object.getOwnPropertyDescriptor(e,"key").get;if(o&&o.isReactWarning)return!1}return e.key!==void 0}function J(e,o){function u(){Ft||(Ft=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",o))}u.isReactWarning=!0,Object.defineProperty(e,"key",{get:u,configurable:!0})}function le(){var e=W(this.type);return Bt[e]||(Bt[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function T(e,o,u,d,b,A){var S=u.ref;return e={$$typeof:Pe,type:e,key:o,props:u,_owner:d},(S!==void 0?S:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:le}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:b}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:A}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function U(e,o){return o=T(e.type,o,e.props,e._owner,e._debugStack,e._debugTask),e._store&&(o._store.validated=e._store.validated),o}function ae(e){oe(e)?e._store&&(e._store.validated=1):typeof e=="object"&&e!==null&&e.$$typeof===ke&&(e._payload.status==="fulfilled"?oe(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function oe(e){return typeof e=="object"&&e!==null&&e.$$typeof===Pe}function Te(e){var o={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(u){return o[u]})}function $(e,o){return typeof e=="object"&&e!==null&&e.key!=null?(D(e.key),Te(""+e.key)):o.toString(36)}function We(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(v,v):(e.status="pending",e.then(function(o){e.status==="pending"&&(e.status="fulfilled",e.value=o)},function(o){e.status==="pending"&&(e.status="rejected",e.reason=o)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function de(e,o,u,d,b){var A=typeof e;(A==="undefined"||A==="boolean")&&(e=null);var S=!1;if(e===null)S=!0;else switch(A){case"bigint":case"string":case"number":S=!0;break;case"object":switch(e.$$typeof){case Pe:case Xe:S=!0;break;case ke:return S=e._init,de(S(e._payload),o,u,d,b)}}if(S){S=e,b=b(S);var z=d===""?"."+$(S,0):d;return zt(b)?(u="",z!=null&&(u=z.replace(Yt,"$&/")+"/"),de(b,o,u,"",function(Re){return Re})):b!=null&&(oe(b)&&(b.key!=null&&(S&&S.key===b.key||D(b.key)),u=U(b,u+(b.key==null||S&&S.key===b.key?"":(""+b.key).replace(Yt,"$&/")+"/")+z),d!==""&&S!=null&&oe(S)&&S.key==null&&S._store&&!S._store.validated&&(u._store.validated=2),b=u),o.push(b)),1}if(S=0,z=d===""?".":d+":",zt(e))for(var I=0;I<e.length;I++)d=e[I],A=z+$(d,I),S+=de(d,o,u,A,b);else if(I=s(e),typeof I=="function")for(I===e.entries&&(Vt||console.warn("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Vt=!0),e=I.call(e),I=0;!(d=e.next()).done;)d=d.value,A=z+$(d,I++),S+=de(d,o,u,A,b);else if(A==="object"){if(typeof e.then=="function")return de(We(e),o,u,d,b);throw o=String(e),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.")}return S}function Le(e,o,u){if(e==null)return e;var d=[],b=0;return de(e,d,"","",function(A){return o.call(u,A,b++)}),d}function ze(e){if(e._status===-1){var o=e._ioInfo;o!=null&&(o.start=o.end=performance.now()),o=e._result;var u=o();if(u.then(function(b){if(e._status===0||e._status===-1){e._status=1,e._result=b;var A=e._ioInfo;A!=null&&(A.end=performance.now()),u.status===void 0&&(u.status="fulfilled",u.value=b)}},function(b){if(e._status===0||e._status===-1){e._status=2,e._result=b;var A=e._ioInfo;A!=null&&(A.end=performance.now()),u.status===void 0&&(u.status="rejected",u.reason=b)}}),o=e._ioInfo,o!=null){o.value=u;var d=u.displayName;typeof d=="string"&&(o.name=d)}e._status===-1&&(e._status=0,e._result=u)}if(e._status===1)return o=e._result,o===void 0&&console.error(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,o),"default"in o||console.error(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,o),o.default;throw e._result}function V(){var e=_.H;return e===null&&console.error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://react.dev/link/invalid-hook-call for tips about how to debug and fix this problem.`),e}function je(){_.asyncTransitions--}function Ee(e){if(Ze===null)try{var o=("require"+Math.random()).slice(0,7);Ze=(t&&t[o]).call(t,"timers").setImmediate}catch{Ze=function(d){qt===!1&&(qt=!0,typeof MessageChannel>"u"&&console.error("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var b=new MessageChannel;b.port1.onmessage=d,b.port2.postMessage(void 0)}}return Ze(e)}function Se(e){return 1<e.length&&typeof AggregateError=="function"?new AggregateError(e):e[0]}function ue(e,o){o!==Je-1&&console.error("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Je=o}function we(e,o,u){var d=_.actQueue;if(d!==null)if(d.length!==0)try{Fe(d),Ee(function(){return we(e,o,u)});return}catch(b){_.thrownErrors.push(b)}else _.actQueue=null;0<_.thrownErrors.length?(d=Se(_.thrownErrors),_.thrownErrors.length=0,u(d)):o(e)}function Fe(e){if(!ft){ft=!0;var o=0;try{for(;o<e.length;o++){var u=e[o];do{_.didUsePromise=!1;var d=u(!1);if(d!==null){if(_.didUsePromise){e[o]=u,e.splice(0,o);return}u=d}else break}while(1)}e.length=0}catch(b){e.splice(0,o+1),_.thrownErrors.push(b)}finally{ft=!1}}}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var Pe=Symbol.for("react.transitional.element"),Xe=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),P=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),se=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),ke=Symbol.for("react.lazy"),$t=Symbol.for("react.activity"),Ut=Symbol.iterator,Ot={},Dt={isMounted:function(){return!1},enqueueForceUpdate:function(e){c(e,"forceUpdate")},enqueueReplaceState:function(e){c(e,"replaceState")},enqueueSetState:function(e){c(e,"setState")}},Mt=Object.assign,ut={};Object.freeze(ut),l.prototype.isReactComponent={},l.prototype.setState=function(e,o){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,o,"setState")},l.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};var ce={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]};for(xe in ce)ce.hasOwnProperty(xe)&&n(xe,ce[xe]);g.prototype=l.prototype,ce=y.prototype=new g,ce.constructor=y,Mt(ce,l.prototype),ce.isPureReactComponent=!0;var zt=Array.isArray,Ir=Symbol.for("react.client.reference"),_={H:null,A:null,T:null,S:null,actQueue:null,asyncTransitions:0,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1,didUsePromise:!1,thrownErrors:[],getCurrentStack:null,recentlyCreatedOwnerStacks:0},Qe=Object.prototype.hasOwnProperty,jt=console.createTask?console.createTask:function(){return null};ce={react_stack_bottom_frame:function(e){return e()}};var Ft,xt,Bt={},Lr=ce.react_stack_bottom_frame.bind(ce,ne)(),Pr=jt(X(ne)),Vt=!1,Yt=/\/+/g,Ht=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},qt=!1,Ze=null,Je=0,et=!1,ft=!1,Gt=typeof queueMicrotask=="function"?function(e){queueMicrotask(function(){return queueMicrotask(e)})}:Ee;ce=Object.freeze({__proto__:null,c:function(e){return V().useMemoCache(e)}});var xe={map:Le,forEach:function(e,o,u){Le(e,function(){o.apply(this,arguments)},u)},count:function(e){var o=0;return Le(e,function(){o++}),o},toArray:function(e){return Le(e,function(o){return o})||[]},only:function(e){if(!oe(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};r.Activity=$t,r.Children=xe,r.Component=l,r.Fragment=i,r.Profiler=w,r.PureComponent=y,r.StrictMode=f,r.Suspense=M,r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_,r.__COMPILER_RUNTIME=ce,r.act=function(e){var o=_.actQueue,u=Je;Je++;var d=_.actQueue=o!==null?o:[],b=!1;try{var A=e()}catch(I){_.thrownErrors.push(I)}if(0<_.thrownErrors.length)throw ue(o,u),e=Se(_.thrownErrors),_.thrownErrors.length=0,e;if(A!==null&&typeof A=="object"&&typeof A.then=="function"){var S=A;return Gt(function(){b||et||(et=!0,console.error("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),{then:function(I,Re){b=!0,S.then(function(Ne){if(ue(o,u),u===0){try{Fe(d),Ee(function(){return we(Ne,I,Re)})}catch($r){_.thrownErrors.push($r)}if(0<_.thrownErrors.length){var Nr=Se(_.thrownErrors);_.thrownErrors.length=0,Re(Nr)}}else I(Ne)},function(Ne){ue(o,u),0<_.thrownErrors.length&&(Ne=Se(_.thrownErrors),_.thrownErrors.length=0),Re(Ne)})}}}var z=A;if(ue(o,u),u===0&&(Fe(d),d.length!==0&&Gt(function(){b||et||(et=!0,console.error("A component suspended inside an `act` scope, but the `act` call was not awaited. When testing React components that depend on asynchronous data, you must await the result:\n\nawait act(() => ...)"))}),_.actQueue=null),0<_.thrownErrors.length)throw e=Se(_.thrownErrors),_.thrownErrors.length=0,e;return{then:function(I,Re){b=!0,u===0?(_.actQueue=d,Ee(function(){return we(z,I,Re)})):I(z)}}},r.cache=function(e){return function(){return e.apply(null,arguments)}},r.cacheSignal=function(){return null},r.captureOwnerStack=function(){var e=_.getCurrentStack;return e===null?null:e()},r.cloneElement=function(e,o,u){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var d=Mt({},e.props),b=e.key,A=e._owner;if(o!=null){var S;e:{if(Qe.call(o,"ref")&&(S=Object.getOwnPropertyDescriptor(o,"ref").get)&&S.isReactWarning){S=!1;break e}S=o.ref!==void 0}S&&(A=N()),q(o)&&(D(o.key),b=""+o.key);for(z in o)!Qe.call(o,z)||z==="key"||z==="__self"||z==="__source"||z==="ref"&&o.ref===void 0||(d[z]=o[z])}var z=arguments.length-2;if(z===1)d.children=u;else if(1<z){S=Array(z);for(var I=0;I<z;I++)S[I]=arguments[I+2];d.children=S}for(d=T(e.type,b,d,A,e._debugStack,e._debugTask),b=2;b<arguments.length;b++)ae(arguments[b]);return d},r.createContext=function(e){return e={$$typeof:P,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:E,_context:e},e._currentRenderer=null,e._currentRenderer2=null,e},r.createElement=function(e,o,u){for(var d=2;d<arguments.length;d++)ae(arguments[d]);d={};var b=null;if(o!=null)for(I in xt||!("__self"in o)||"key"in o||(xt=!0,console.warn("Your app (or one of its dependencies) is using an outdated JSX transform. Update to the modern JSX transform for faster performance: https://react.dev/link/new-jsx-transform")),q(o)&&(D(o.key),b=""+o.key),o)Qe.call(o,I)&&I!=="key"&&I!=="__self"&&I!=="__source"&&(d[I]=o[I]);var A=arguments.length-2;if(A===1)d.children=u;else if(1<A){for(var S=Array(A),z=0;z<A;z++)S[z]=arguments[z+2];Object.freeze&&Object.freeze(S),d.children=S}if(e&&e.defaultProps)for(I in A=e.defaultProps,A)d[I]===void 0&&(d[I]=A[I]);b&&J(d,typeof e=="function"?e.displayName||e.name||"Unknown":e);var I=1e4>_.recentlyCreatedOwnerStacks++;return T(e,b,d,N(),I?Error("react-stack-top-frame"):Lr,I?jt(X(e)):Pr)},r.createRef=function(){var e={current:null};return Object.seal(e),e},r.forwardRef=function(e){e!=null&&e.$$typeof===Q?console.error("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof e!="function"?console.error("forwardRef requires a render function but was given %s.",e===null?"null":typeof e):e.length!==0&&e.length!==2&&console.error("forwardRef render functions accept exactly two parameters: props and ref. %s",e.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),e!=null&&e.defaultProps!=null&&console.error("forwardRef render functions do not support defaultProps. Did you accidentally pass a React component?");var o={$$typeof:O,render:e},u;return Object.defineProperty(o,"displayName",{enumerable:!1,configurable:!0,get:function(){return u},set:function(d){u=d,e.name||e.displayName||(Object.defineProperty(e,"name",{value:d}),e.displayName=d)}}),o},r.isValidElement=oe,r.lazy=function(e){e={_status:-1,_result:e};var o={$$typeof:ke,_payload:e,_init:ze},u={name:"lazy",start:-1,end:-1,value:null,owner:null,debugStack:Error("react-stack-top-frame"),debugTask:console.createTask?console.createTask("lazy()"):null};return e._ioInfo=u,o._debugInfo=[{awaited:u}],o},r.memo=function(e,o){e==null&&console.error("memo: The first argument must be a component. Instead received: %s",e===null?"null":typeof e),o={$$typeof:Q,type:e,compare:o===void 0?null:o};var u;return Object.defineProperty(o,"displayName",{enumerable:!1,configurable:!0,get:function(){return u},set:function(d){u=d,e.name||e.displayName||(Object.defineProperty(e,"name",{value:d}),e.displayName=d)}}),o},r.startTransition=function(e){var o=_.T,u={};u._updatedFibers=new Set,_.T=u;try{var d=e(),b=_.S;b!==null&&b(u,d),typeof d=="object"&&d!==null&&typeof d.then=="function"&&(_.asyncTransitions++,d.then(je,je),d.then(v,Ht))}catch(A){Ht(A)}finally{o===null&&u._updatedFibers&&(e=u._updatedFibers.size,u._updatedFibers.clear(),10<e&&console.warn("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table.")),o!==null&&u.types!==null&&(o.types!==null&&o.types!==u.types&&console.error("We expected inner Transitions to have transferred the outer types set and that you cannot add to the outer Transition while inside the inner.This is a bug in React."),o.types=u.types),_.T=o}},r.unstable_useCacheRefresh=function(){return V().useCacheRefresh()},r.use=function(e){return V().use(e)},r.useActionState=function(e,o,u){return V().useActionState(e,o,u)},r.useCallback=function(e,o){return V().useCallback(e,o)},r.useContext=function(e){var o=V();return e.$$typeof===E&&console.error("Calling useContext(Context.Consumer) is not supported and will cause bugs. Did you mean to call useContext(Context) instead?"),o.useContext(e)},r.useDebugValue=function(e,o){return V().useDebugValue(e,o)},r.useDeferredValue=function(e,o){return V().useDeferredValue(e,o)},r.useEffect=function(e,o){return e==null&&console.warn("React Hook useEffect requires an effect callback. Did you forget to pass a callback to the hook?"),V().useEffect(e,o)},r.useEffectEvent=function(e){return V().useEffectEvent(e)},r.useId=function(){return V().useId()},r.useImperativeHandle=function(e,o,u){return V().useImperativeHandle(e,o,u)},r.useInsertionEffect=function(e,o){return e==null&&console.warn("React Hook useInsertionEffect requires an effect callback. Did you forget to pass a callback to the hook?"),V().useInsertionEffect(e,o)},r.useLayoutEffect=function(e,o){return e==null&&console.warn("React Hook useLayoutEffect requires an effect callback. Did you forget to pass a callback to the hook?"),V().useLayoutEffect(e,o)},r.useMemo=function(e,o){return V().useMemo(e,o)},r.useOptimistic=function(e,o){return V().useOptimistic(e,o)},r.useReducer=function(e,o,u){return V().useReducer(e,o,u)},r.useRef=function(e){return V().useRef(e)},r.useState=function(e){return V().useState(e)},r.useSyncExternalStore=function(e,o,u){return V().useSyncExternalStore(e,o,u)},r.useTransition=function(){return V().useTransition()},r.version="19.2.4",typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()}(Ue,Ue.exports)),Ue.exports}process.env.NODE_ENV==="production"?Qt():Zt();const G={};G.componentMountErrors=[],G.componentMountCount=0,G.settingsLoadAttempts=0,G.serviceErrors={lastfm:[],librefm:[],listenbrainz:[],trakt:[]},G.apiCallCount=0,G.connectionAttempts=0,G.lastCredentialValidation={lastfm:!1,librefm:!1,listenbrainz:!1,trakt:!1};const Ye=function(...t){return console.log("[Debug]",...t)},Et=function(...t){return console.error("[Debug] Error:",...t)};function Ce(t,r){G[t]=r,t==="lastError"&&r?Et("Error recorded:",r.message):t==="lastTrack"&&r?Ye("Track updated:",`${r.artist} - ${r.name}`):t==="currentService"&&r&&Ye("Service changed to:",r)}function wt(){G.apiCallCount=(G.apiCallCount||0)+1,Ye(`API call count: ${G.apiCallCount}`)}function He(t,r){G.serviceErrors=G.serviceErrors||{lastfm:[],librefm:[],listenbrainz:[],trakt:[]},G.serviceErrors[t]=G.serviceErrors[t]||[],G.serviceErrors[t].push(`${new Date().toISOString()}: ${r}`),G.serviceErrors[t].length>10&&(G.serviceErrors[t]=G.serviceErrors[t].slice(-10)),Et(`${t} error:`,r)}function Rt(){G.lastSuccessfulUpdate=new Date().toISOString(),Ye("Successful update recorded at:",G.lastSuccessfulUpdate)}function nt(t,r){return nt=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},nt(t,r)}function qe(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&nt(t,r)}let Ge=function(){function t(){he(this,t)}return ye(t,[{key:"log",value:function(...r){console.log(`[${this.getServiceName()}]`,...r)}},{key:"logError",value:function(...r){console.error(`[${this.getServiceName()}] Error:`,...r)}},{key:"logVerbose",value:function(...r){console.log(`[${this.getServiceName()}] Verbose:`,...r)}},{key:"handleError",value:async function(r){this.lastError=r.error||0;const n=this.getErrorMessage(r);throw this.logError(n),He(this.getServiceName().toLowerCase(),n),new Error(`${this.getServiceName()} API Error: ${n}`)}},{key:"getErrorMessage",value:function(r){return r.error&&L.API_ERROR_CODES[r.error]?L.API_ERROR_CODES[r.error]:r.message||r.toString()||"Unknown error"}},{key:"makeRequest",value:async function(r,n={}){try{this.logVerbose(`Making request to: ${r}`),wt();const s=await fetch(r,{...n,headers:{"User-Agent":"Vendetta Multi-Service Scrobbler/3.0.0",...n.headers}});if(!s.ok){const l=new Error(`HTTP ${s.status}: ${s.statusText}`);throw He(this.getServiceName().toLowerCase(),l.message),l}const c=await s.json();return c.error&&await this.handleError(c),this.retryCount=0,c}catch(s){if(this.retryCount++,this.retryCount>L.MAX_RETRY_ATTEMPTS)throw this.retryCount=0,He(this.getServiceName().toLowerCase(),`Max retries exceeded: ${s.message}`),s;return this.logVerbose(`Request failed, retrying (${this.retryCount}/${L.MAX_RETRY_ATTEMPTS})`),await new Promise(function(c){return setTimeout(c,L.RETRY_DELAY)}),this.makeRequest(r,n)}}},{key:"isDefaultCover",value:function(r){return r?L.DEFAULT_COVER_HASHES.some(function(n){return r.includes(n)}):!0}},{key:"processAlbumArt",value:function(r){return!r||this.isDefaultCover(r)?null:r}},{key:"getLastError",value:function(){return this.lastError}},{key:"resetRetryCount",value:function(){this.retryCount=0}}]),t}(),Jt=function(t){qe(r,t);function r(){return he(this,r),Be._(this,r,arguments)}return ye(r,[{key:"getServiceName",value:function(){return"Last.fm"}},{key:"logVerbose",value:function(...n){p.verboseLogging&&console.log(`[${this.getServiceName()}] Verbose:`,...n)}},{key:"validateCredentials",value:async function(){try{if(!p.username||!p.apiKey)throw new Error("Username or API key not set");const n=new URLSearchParams({method:"user.getinfo",user:p.username,api_key:p.apiKey,format:"json"}),s=`${L.SERVICES.lastfm.baseUrl}?${n}`;return await this.makeRequest(s),this.log("Credentials validation successful"),!0}catch(n){return this.logError("Credentials validation failed:",n),!1}}},{key:"fetchLatestScrobble",value:async function(){try{if(!p.username||!p.apiKey)throw new Error("Username or API key not set");this.logVerbose("Fetching latest scrobble for user:",p.username);const n=new URLSearchParams({method:"user.getrecenttracks",user:p.username,api_key:p.apiKey,limit:"1",extended:"1",format:"json"}),s=`${L.SERVICES.lastfm.baseUrl}?${n}`,c=(await this.makeRequest(s))?.recenttracks?.track?.[0];if(!c)throw new Error("No tracks found");this.logVerbose("Raw track data:",c);const l=Boolean(c["@attr"]?.nowplaying),g=c.date?.uts?parseInt(c.date.uts):Math.floor(Date.now()/1e3);let y=null,v=null;if(l)try{const W=new URLSearchParams({method:"track.getInfo",track:c.name,artist:c.artist.name,api_key:p.apiKey,format:"json"}),X=`${L.SERVICES.lastfm.baseUrl}?${W}`,N=await this.makeRequest(X);N?.track?.duration&&(y=parseInt(N.track.duration),y>0&&(y=Math.floor(y/1e3),v=g+y))}catch(W){this.logVerbose("Failed to fetch track duration:",W)}const C=this.processAlbumArt(c.image?.find(function(W){return W.size==="large"})?.["#text"]),D={name:c.name,artist:c.artist.name,album:c.album["#text"],albumArt:C,url:c.url,date:c.date?.["#text"]??"now",nowPlaying:l,loved:c.loved==="1",from:g,to:v,duration:y};return this.logVerbose("Processed track:",D),this.log(`${l?"Now playing":"Last played"}:`,`${D.artist} - ${D.name}`),D}catch(n){throw this.logError("Failed to fetch latest scrobble:",n),n}}}]),r}(Ge),er=function(t){qe(r,t);function r(){return he(this,r),Be._(this,r,arguments)}return ye(r,[{key:"getServiceName",value:function(){return"Libre.fm"}},{key:"logVerbose",value:function(...n){p.verboseLogging&&console.log(`[${this.getServiceName()}] Verbose:`,...n)}},{key:"validateCredentials",value:async function(){try{const n=p.librefmUsername,s=p.librefmApiKey;if(!n||!s)throw new Error("Username or API key not set for Libre.fm");const c=new URLSearchParams({method:"user.getinfo",user:n,api_key:s,format:"json"}),l=`${L.SERVICES.librefm.baseUrl}?${c}`;return await this.makeRequest(l),this.log("Credentials validation successful"),!0}catch(n){return this.logError("Credentials validation failed:",n),!1}}},{key:"fetchLatestScrobble",value:async function(){try{const n=p.librefmUsername,s=p.librefmApiKey;if(!n||!s)throw new Error("Username or API key not set for Libre.fm");this.logVerbose("Fetching latest scrobble for user:",n);const c=new URLSearchParams({method:"user.getrecenttracks",user:n,api_key:s,limit:"1",extended:"1",format:"json"}),l=`${L.SERVICES.librefm.baseUrl}?${c}`,g=(await this.makeRequest(l))?.recenttracks?.track?.[0];if(!g)throw new Error("No tracks found");this.logVerbose("Raw track data:",g);const y=Boolean(g["@attr"]?.nowplaying),v=g.date?.uts?parseInt(g.date.uts):Math.floor(Date.now()/1e3);let C=null,D=null;if(y)try{const N=new URLSearchParams({method:"track.getInfo",track:g.name,artist:g.artist.name,api_key:s,format:"json"}),ne=`${L.SERVICES.librefm.baseUrl}?${N}`,q=await this.makeRequest(ne);q?.track?.duration&&(C=parseInt(q.track.duration),C>0&&(C=Math.floor(C/1e3),D=v+C))}catch(N){this.logVerbose("Failed to fetch track duration:",N)}const W=this.processAlbumArt(g.image?.find(function(N){return N.size==="large"})?.["#text"]),X={name:g.name,artist:g.artist.name,album:g.album["#text"],albumArt:W,url:g.url,date:g.date?.["#text"]??"now",nowPlaying:y,loved:g.loved==="1",from:v,to:D,duration:C};return this.logVerbose("Processed track:",X),this.log(`${y?"Now playing":"Last played"}:`,`${X.artist} - ${X.name}`),X}catch(n){throw this.logError("Failed to fetch latest scrobble:",n),n}}}]),r}(Ge),tr=function(t){qe(r,t);function r(){return he(this,r),Be._(this,r,arguments)}return ye(r,[{key:"getServiceName",value:function(){return"ListenBrainz"}},{key:"logVerbose",value:function(...n){p.verboseLogging&&console.log(`[${this.getServiceName()}] Verbose:`,...n)}},{key:"validateCredentials",value:async function(){try{const n=p.listenbrainzUsername,s=p.listenbrainzToken;if(!n)throw new Error("Username not set for ListenBrainz");const c=`${L.SERVICES.listenbrainz.baseUrl}/user/${encodeURIComponent(n)}/listens?count=1`,l={};return s&&(l.Authorization=`Token ${s}`),await this.makeRequest(c,{headers:l}),this.log("Credentials validation successful"),!0}catch(n){return this.logError("Credentials validation failed:",n),!1}}},{key:"fetchLatestScrobble",value:async function(){try{const n=p.listenbrainzUsername,s=p.listenbrainzToken;if(!n)throw new Error("Username not set for ListenBrainz");this.logVerbose("Fetching latest scrobble for user:",n);let c=null;const l=function(N){if(N){if(Array.isArray(N.listens))return N.listens;if(N.payload&&Array.isArray(N.payload.listens))return N.payload.listens;if(N.data&&Array.isArray(N.data.listens))return N.data.listens}};try{const N=`${L.SERVICES.listenbrainz.baseUrl}/user/${encodeURIComponent(n)}/playing-now`,ne={};s&&(ne.Authorization=`Token ${s}`);const q=await this.makeRequest(N,{headers:ne}),J=l(q);J&&J.length>0&&(c=J[0],c.playing_now=!0)}catch(N){this.logVerbose("No currently playing track or failed to fetch:",N)}let g;if(c)g=c,this.logVerbose("Using currently playing track");else{const N=`${L.SERVICES.listenbrainz.baseUrl}/user/${encodeURIComponent(n)}/listens?count=1`,ne={};s&&(ne.Authorization=`Token ${s}`);const q=await this.makeRequest(N,{headers:ne}),J=function(){if(q){if(Array.isArray(q.listens))return q.listens;if(q.payload&&Array.isArray(q.payload.listens))return q.payload.listens;if(q.data&&Array.isArray(q.data.listens))return q.data.listens}}();if(!J||J.length===0)throw new Error("No listens found");g=J[0],this.logVerbose("Using latest completed listen")}this.logVerbose("Raw listen data:",g);const y=Boolean(g.playing_now),v=g.listened_at||Math.floor(Date.now()/1e3);let C=null,D=null;g.track_metadata.additional_info?.duration_ms&&(C=Math.floor(g.track_metadata.additional_info.duration_ms/1e3),y&&C>0&&(D=v+C));const W=null;if(g.track_metadata.additional_info?.release_mbid)try{}catch(N){this.logVerbose("Failed to fetch album art:",N)}const X={name:g.track_metadata.track_name,artist:g.track_metadata.artist_name,album:g.track_metadata.release_name||"",albumArt:W,url:g.track_metadata.additional_info?.origin_url||`https://listenbrainz.org/user/${n}`,date:y?"now":new Date(v*1e3).toISOString(),nowPlaying:y,loved:!1,from:v,to:D,duration:C};return this.logVerbose("Processed track:",X),this.log(`${y?"Now playing":"Last played"}:`,`${X.artist} - ${X.name}`),X}catch(n){throw this.logError("Failed to fetch latest listen:",n),n}}},{key:"getErrorMessage",value:function(n){return n.error?n.error:n.message?n.message:n.toString()||"Unknown error"}}]),r}(Ge),rr=function(t){qe(r,t);function r(){return he(this,r),Be._(this,r,arguments)}return ye(r,[{key:"getServiceName",value:function(){return"Trakt"}},{key:"logVerbose",value:function(...n){p.verboseLogging&&console.log(`[${this.getServiceName()}] Verbose:`,...n)}},{key:"getHeaders",value:function(){const n={"Content-Type":"application/json","trakt-api-version":"2","trakt-api-key":p.traktClientId};return p.traktAccessToken&&(n.Authorization=`Bearer ${p.traktAccessToken}`),n}},{key:"validateCredentials",value:async function(){try{const n=p.traktUsername,s=p.traktClientId;if(!n||!s)throw new Error("Username or Client ID not set for Trakt");const c=`${L.SERVICES.trakt.baseUrl}/users/${encodeURIComponent(n)}`;return await this.makeRequest(c,{headers:this.getHeaders()}),this.log("Credentials validation successful"),!0}catch(n){return this.logError("Credentials validation failed:",n),!1}}},{key:"fetchLatestScrobble",value:async function(){try{const n=p.traktUsername;if(!n)throw new Error("Username not set for Trakt");this.logVerbose("Fetching latest activity for user:",n);const s=`${L.SERVICES.trakt.baseUrl}/users/${encodeURIComponent(n)}/watching`;let c=null;try{const v=await fetch(s,{headers:this.getHeaders()});v.status===200?c=await v.json():v.status!==204&&this.logVerbose(`Watching API returned status ${v.status}`)}catch(v){this.logVerbose("Failed to fetch watching status:",v)}if(c)return this.logVerbose("User is currently watching:",c),this.mapWatchingToTrack(c);const l=`${L.SERVICES.trakt.baseUrl}/users/${encodeURIComponent(n)}/history?limit=1`,g=await this.makeRequest(l,{headers:this.getHeaders()});if(!g||g.length===0)throw new Error("No history found");const y=g[0];return this.logVerbose("Latest history item:",y),this.mapHistoryToTrack(y)}catch(n){throw this.logError("Failed to fetch latest activity:",n),n}}},{key:"mapWatchingToTrack",value:function(n){const s=n.type==="episode",c=s?n.episode?.title||`Episode ${n.episode?.number}`:n.movie?.title||"Unknown Movie",l=s?n.show?.title||"Unknown Show":`Movie (${n.movie?.year||"Unknown Year"})`,g=s?`Season ${n.episode?.season}, Episode ${n.episode?.number}`:"",y=Math.floor(new Date(n.started_at).getTime()/1e3),v=Math.floor(new Date(n.expires_at).getTime()/1e3),C=v-y;return{name:c,artist:l,album:g,albumArt:null,url:`https://trakt.tv/users/${p.traktUsername}`,date:"now",nowPlaying:!0,loved:!1,from:y,to:v,duration:C}}},{key:"mapHistoryToTrack",value:function(n){const s=n.type==="episode",c=s?n.episode?.title||`Episode ${n.episode?.number}`:n.movie?.title||"Unknown Movie",l=s?n.show?.title||"Unknown Show":`Movie (${n.movie?.year||"Unknown Year"})`,g=s?`Season ${n.episode?.season}, Episode ${n.episode?.number}`:"",y=Math.floor(new Date(n.watched_at).getTime()/1e3);return{name:c,artist:l,album:g,albumArt:null,url:`https://trakt.tv/users/${p.traktUsername}`,date:n.watched_at,nowPlaying:!1,loved:!1,from:y,to:null,duration:null}}}]),r}(Ge);const be=function(){function t(){he(this,t),this.serviceInstances=new Map}return ye(t,[{key:"getService",value:function(r){this.serviceInstances||(this.serviceInstances=new Map);const n=r||p.service;if(!n)throw new Error("[ServiceFactory] No service type specified and no default service configured");return this.serviceInstances.has(n)||this.serviceInstances.set(n,this.createService(n)),this.serviceInstances.get(n)}},{key:"getCurrentService",value:function(){return this.getService(p.service)}},{key:"createService",value:function(r){switch(r){case"lastfm":return new Jt;case"librefm":return new er;case"listenbrainz":return new tr;case"trakt":return new rr;default:throw new Error(`[ServiceFactory] Unknown service type: ${r}`)}}},{key:"clearCache",value:function(){this.serviceInstances?this.serviceInstances.clear():this.serviceInstances=new Map}},{key:"validateCurrentService",value:function(){return this.getCurrentService().validateCredentials()}},{key:"testService",value:async function(r){try{return await this.getService(r).validateCredentials()}catch(n){return console.error(`[ServiceFactory] Failed to test ${r}:`,n),!1}}},{key:"getSupportedServices",value:function(){return["lastfm","librefm","listenbrainz","trakt"]}},{key:"getServiceDisplayName",value:function(r){return this.getService(r).getServiceName()}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}().getInstance();function Tt(t){if(!t||t<0)return"0:00";const r=Math.floor(t/3600),n=Math.floor(t%3600/60),s=Math.floor(t%60);return r>0?`${r}:${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${n}:${s.toString().padStart(2,"0")}`}function St(){return Math.floor(Date.now()/1e3)}var nr=function(t){return t[t.PLAYING=0]="PLAYING",t[t.STREAMING=1]="STREAMING",t[t.LISTENING=2]="LISTENING",t[t.COMPETING=5]="COMPETING",t}(nr||{});const Z=function(...t){return console.log("[Scrobble Plugin]",...t)},ve=function(...t){return console.error("[Scrobble Plugin] Error:",...t)},ee=function(...t){return p.verboseLogging&&console.log("[Scrobble Plugin] Verbose:",...t)},at=function(){function t(){he(this,t)}return ye(t,[{key:"updateActivity",value:async function(){if(K.pluginStopped){Z("Plugin is stopped; skipping activity updates and clearing timers"),ee("Plugin is stopped, skipping update");try{this.stopUpdates(),ee("Update timers cleared due to stopped plugin")}catch(s){ve("Error while stopping updates for stopped plugin:",s)}return}const r=be.getCurrentService().getServiceName();ee(`Fetching latest track from ${r}...`);let n=!1;try{if(pt&&p.ignoreList&&p.ignoreList.length>0){const g=pt.findActivity(function(y){return y.name?p.ignoreList.some(function(v){return y.name.toLowerCase().includes(v.toLowerCase())}):!1});if(g){Z(`Ignored app (${g.name}) is currently active; clearing activity and skipping updates`),ee(`Ignored app (${g.name}) is currently playing, clearing activity`);try{Ce("ignoredActivity",g.name)}catch(y){ee("Failed to set debug info for ignored activity:",y)}rt();return}}wt();const s=await be.getCurrentService().fetchLatestScrobble();if(Ce("lastTrack",s),!s.nowPlaying){Z("No currently playing track reported by service; clearing activity and skipping RPC update"),ee("Track is not currently playing");try{Ce("lastTrack_nowPlaying",!1)}catch(g){ee("Failed to set debug info for nowPlaying:",g)}rt();return}if(K.lastTrackUrl===s.url){Z("Track unchanged; skipping Discord RPC update"),ee("Track hasn't changed"),Rt(),this.consecutiveFailures=0;return}n=!0,Z(`\u{1F3B5} Track changed: ${s.artist} - ${s.name}`);let c;if(s.nowPlaying&&p.showTimestamp&&s.from){const g=St();let y=s.from;if(y<g-3600){if(s.duration&&s.duration>0){const v=Math.min(s.duration*.1,30);y=g-v}else y=g;ee("had to estimate start time")}c={start:y*1e3},s.to&&(c.end=s.to*1e3)}ee(`\u{1F3AF} Preparing RPC update for: ${s.artist} - ${s.name}`);const l={name:p.appName||L.DEFAULT_APP_NAME,flags:0,type:p.listeningTo?2:0,details:s.name,state:`${s.artist}`,status_display_type:1,application_id:L.APPLICATION_ID};if(l.name.includes("{{")){const g={artist:s.artist,name:s.name,album:s.album,service:r};for(const[y,v]of Object.entries(g))l.name=l.name.replace(new RegExp(`{{${y}}}`,"g"),v||"")}if(c&&(l.timestamps=c,ee("Timestamps set:",{start:new Date(c.start).toISOString(),end:c.end?new Date(c.end).toISOString():"none",duration:s.duration?Tt(s.duration):"unknown"})),s.album||s.albumArt){const g=s.albumArt?[s.albumArt]:[];let y=(await Xt(g))[0];if(y){if(l.assets={large_image:y},p.showLargeText){let v="";if(p.showAlbumInTooltip&&s.album&&(v+=`on ${s.album}`),p.showDurationInTooltip&&s.duration){const C=Tt(s.duration);v?v+=` \u2022 ${C}`:v=C}v&&(l.assets.large_text=v)}ee("Album art set:",y),l.assets.large_text&&ee("Tooltip text set:",l.assets.large_text)}else s.album&&p.showLargeText&&p.showAlbumInTooltip&&(l.assets={large_text:`on ${s.album}`})}ee("Setting Discord activity:",l),Ce("lastActivity",l),await bt(l),K.lastTrackUrl=s.url,this.currentActivity=l,K.lastActivity=l,this.consecutiveFailures=0,this.lastUpdateTime=St(),Rt(),Z(`\u2705 RPC updated successfully: ${s.artist} - ${s.name}`)}catch(s){ve("Update failed:",s);try{He(p.service,s.message)}catch(c){ve("Failed to record service error:",c)}try{Ce("lastUpdateError",{message:s.message,service:p.service,lastTrackUrl:K.lastTrackUrl})}catch(c){ee("Failed to set debug info for last update error:",c)}this.handleError(s)}}},{key:"handleError",value:function(r){this.consecutiveFailures++,Ce("lastError",r),ve(`Failure ${this.consecutiveFailures}/${L.MAX_RETRY_ATTEMPTS}:`,r.message),this.consecutiveFailures>=L.MAX_RETRY_ATTEMPTS&&(ve("Max retry attempts reached, initiating reconnection..."),this.startReconnection())}},{key:"startReconnection",value:function(){var r=this;this.isReconnecting||(this.isReconnecting=!0,this.stopUpdates(),Z("Starting reconnection process..."),this.reconnectTimer=setInterval(function(){Z("Attempting to reconnect..."),r.initialize().then(function(){Z("Reconnection successful!"),r.stopReconnection()}).catch(function(n){ve("Reconnection attempt failed:",n.message)})},L.RETRY_DELAY))}},{key:"stopReconnection",value:function(){try{this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=void 0),this.isReconnecting=!1,this.consecutiveFailures=0}catch(r){console.error("[Scrobble Plugin] Reconnection cleanup error:",r)}}},{key:"stopUpdates",value:function(){try{this.updateTimer&&(clearInterval(this.updateTimer),this.updateTimer=void 0)}catch(r){console.error("[Scrobble Plugin] Timer cleanup error:",r)}}},{key:"initialize",value:async function(){var r=this;if(K.pluginStopped)throw new Error("Plugin is stopped");const n=be.getCurrentService().getServiceName();Z(`Initializing with ${n}...`);try{if(!await be.validateCurrentService())throw new Error(`Invalid credentials for ${n}`);Z(`${n} credentials validated successfully`)}catch(c){throw ve(`Failed to validate ${n} credentials:`,c),c}this.stopUpdates(),Z("\u{1F3B5} checking for already playing songs..."),await this.updateActivity();const s=Math.max((Number(p.timeInterval)||L.DEFAULT_SETTINGS.timeInterval)*1e3,L.MIN_UPDATE_INTERVAL*1e3);this.updateTimer=setInterval(function(){return r.updateActivity()},s),Z(`Update timer started with interval: ${s}ms (${s/1e3}s)`)}},{key:"stop",value:function(){if(!K.pluginStopped){Z("Stopping plugin..."),K.pluginStopped=!0;try{this.stopUpdates(),this.stopReconnection(),rt(),Z("Plugin stopped successfully")}catch(r){console.error("[Scrobble Plugin] Stop error:",r)}}}},{key:"switchService",value:async function(r){if(K.pluginStopped)return;Z(`Switching to ${r}...`);const n=!K.pluginStopped;this.stop();try{be.clearCache(),K.lastTrackUrl=void 0,this.currentActivity=void 0,this.lastUpdateTime=0,n&&(K.pluginStopped=!1,await this.initialize())}catch(s){ve("Failed to switch service:",s)}}},{key:"getStatus",value:function(){const r=be.getCurrentService().getServiceName();return{running:!K.pluginStopped,service:r,consecutiveFailures:this.consecutiveFailures,isReconnecting:this.isReconnecting,lastTrackUrl:K.lastTrackUrl,updateInterval:this.updateTimer?"Active":"Inactive"}}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}().getInstance(),ar=function(){return at.initialize()},it=function(){return at.stop()},ir=function(t){return at.switchService(t)},{ScrollView:ge}=pe.findByProps("ScrollView"),{TableRowGroup:Y,TableSwitchRow:kt,TableCheckboxRow:Ae,Stack:te,TableRow:m}=pe.findByProps("TableSwitchRow","TableCheckboxRow","TableRowGroup","Stack","TableRow"),{TextInput:ie}=pe.findByProps("TextInput"),{Linking:or}=a.ReactNative;function sr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(n){return n+1},0),r=async function(){F.showToast("Testing Last.fm connection...",j.getAssetIDByName("ClockIcon"));try{await Ie.testService("lastfm")?F.showToast("\u2705 Last.fm connection successful!",j.getAssetIDByName("CheckIcon")):F.showToast("\u274C Last.fm connection failed",j.getAssetIDByName("XIcon"))}catch{F.showToast("\u274C Connection error",j.getAssetIDByName("XIcon"))}};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Credentials"},a.React.createElement(te,{spacing:4},a.React.createElement(ie,{placeholder:"Last.fm Username",value:h("username"),onChange:function(n){H("username",n),t()},isClearable:!0}),a.React.createElement(ie,{placeholder:"Last.fm API Key",value:h("apiKey"),onChange:function(n){H("apiKey",n),t()},secureTextEntry:!0,isClearable:!0}))),a.React.createElement(Y,{title:"Actions"},a.React.createElement(m,{label:"Test Connection",subLabel:"Verify your Last.fm credentials",trailing:a.React.createElement(m.Arrow,null),onPress:r}),a.React.createElement(m,{label:"Get API Key",subLabel:"Create a Last.fm API key at last.fm/api/account/create",trailing:a.React.createElement(m.Arrow,null),onPress:async function(){try{await or.openURL("https://www.last.fm/api/account/create")}catch(n){console.error("Failed to open Last.fm API URL:",n),F.showToast("Failed to open web browser. Please visit: https://www.last.fm/api/account/create",j.getAssetIDByName("XIcon"))}}}))))}const{Linking:cr}=a.ReactNative;function lr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(n){return n+1},0),r=async function(){F.showToast("Testing Libre.fm connection...",j.getAssetIDByName("ClockIcon"));try{await Ie.testService("librefm")?F.showToast("\u2705 Libre.fm connection successful!",j.getAssetIDByName("CheckIcon")):F.showToast("\u274C Libre.fm connection failed",j.getAssetIDByName("XIcon"))}catch{F.showToast("\u274C Connection error",j.getAssetIDByName("XIcon"))}};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Credentials"},a.React.createElement(te,{spacing:4},a.React.createElement(ie,{placeholder:"Libre.fm Username",value:h("librefmUsername"),onChange:function(n){H("librefmUsername",n),t()},isClearable:!0}),a.React.createElement(ie,{placeholder:"Libre.fm API Key",value:h("librefmApiKey"),onChange:function(n){H("librefmApiKey",n),t()},secureTextEntry:!0,isClearable:!0}))),a.React.createElement(Y,{title:"Actions"},a.React.createElement(m,{label:"Test Connection",subLabel:"Verify your Libre.fm credentials",trailing:a.React.createElement(m.Arrow,null),onPress:r}),a.React.createElement(m,{label:"Get API Key",subLabel:"Create a Last.fm API key (compatible with Libre.fm)",trailing:a.React.createElement(m.Arrow,null),onPress:async function(){try{await cr.openURL("https://www.last.fm/api/account/create")}catch(n){console.error("Failed to open Last.fm API URL:",n),F.showToast("Failed to open web browser. Please visit: https://www.last.fm/api/account/create",j.getAssetIDByName("XIcon"))}}}))))}const{Linking:ur}=a.ReactNative;function fr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(n){return n+1},0),r=async function(){F.showToast("Testing ListenBrainz connection...",j.getAssetIDByName("ClockIcon"));try{await Ie.testService("listenbrainz")?F.showToast("\u2705 ListenBrainz connection successful!",j.getAssetIDByName("CheckIcon")):F.showToast("\u274C ListenBrainz connection failed",j.getAssetIDByName("XIcon"))}catch{F.showToast("\u274C Connection error",j.getAssetIDByName("XIcon"))}};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Credentials"},a.React.createElement(te,{spacing:4},a.React.createElement(ie,{placeholder:"ListenBrainz Username",value:h("listenbrainzUsername"),onChange:function(n){H("listenbrainzUsername",n),t()},isClearable:!0}),a.React.createElement(ie,{placeholder:"ListenBrainz Token (for private profiles)",value:h("listenbrainzToken"),onChange:function(n){H("listenbrainzToken",n),t()},secureTextEntry:!0,isClearable:!0}))),a.React.createElement(Y,{title:"Actions"},a.React.createElement(m,{label:"Test Connection",subLabel:"Verify your ListenBrainz credentials",trailing:a.React.createElement(m.Arrow,null),onPress:r}),a.React.createElement(m,{label:"Get User Token",subLabel:"Get your ListenBrainz user token at listenbrainz.org/settings/",trailing:a.React.createElement(m.Arrow,null),onPress:async function(){try{await ur.openURL("https://listenbrainz.org/settings/")}catch(n){console.error("Failed to open ListenBrainz settings URL:",n),F.showToast("Failed to open web browser. Please visit: https://listenbrainz.org/settings/",j.getAssetIDByName("XIcon"))}}}))))}const{Linking:dr}=a.ReactNative;function gr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(n){return n+1},0),r=async function(){F.showToast("Testing Trakt connection...",j.getAssetIDByName("ClockIcon"));try{await Ie.testService("trakt")?F.showToast("\u2705 Trakt connection successful!",j.getAssetIDByName("CheckIcon")):F.showToast("\u274C Trakt connection failed",j.getAssetIDByName("XIcon"))}catch{F.showToast("\u274C Connection error",j.getAssetIDByName("XIcon"))}};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Credentials"},a.React.createElement(te,{spacing:4},a.React.createElement(ie,{placeholder:"Trakt Username",value:h("traktUsername"),onChange:function(n){H("traktUsername",n),t()},isClearable:!0}),a.React.createElement(ie,{placeholder:"Trakt Client ID",value:h("traktClientId"),onChange:function(n){H("traktClientId",n),t()},isClearable:!0}),a.React.createElement(ie,{placeholder:"Trakt Access Token (Optional for public profiles)",value:h("traktAccessToken"),onChange:function(n){H("traktAccessToken",n),t()},secureTextEntry:!0,isClearable:!0}))),a.React.createElement(Y,{title:"Actions"},a.React.createElement(m,{label:"Test Connection",subLabel:"Verify your Trakt credentials",trailing:a.React.createElement(m.Arrow,null),onPress:r}),a.React.createElement(m,{label:"Get API Credentials",subLabel:"Create a Trakt API app at trakt.tv/oauth/applications",trailing:a.React.createElement(m.Arrow,null),onPress:async function(){try{await dr.openURL("https://trakt.tv/oauth/applications")}catch(n){console.error("Failed to open Trakt API URL:",n),F.showToast("Failed to open web browser. Please visit: https://trakt.tv/oauth/applications",j.getAssetIDByName("XIcon"))}}}))))}function pr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(r){return r+1},0);return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Activity Display"},a.React.createElement(te,{spacing:4},a.React.createElement(ie,{placeholder:`App Name (Default: ${L.DEFAULT_SETTINGS.appName})`,value:h("appName",L.DEFAULT_SETTINGS.appName),onChange:function(r){H("appName",r),t()},isClearable:!0}),a.React.createElement(ie,{placeholder:`Update Interval (Default: ${L.DEFAULT_SETTINGS.timeInterval}s)`,value:String(h("timeInterval",L.DEFAULT_SETTINGS.timeInterval)),onChange:function(r){const n=Number(r);n>=L.MIN_UPDATE_INTERVAL&&(H("timeInterval",n),t())},keyboardType:"numeric",isClearable:!0}))),a.React.createElement(Y,{title:"About Display Settings"},a.React.createElement(m,{label:"App Name",subLabel:"The name shown in Discord for your activity"}),a.React.createElement(m,{label:"Update Interval",subLabel:"How often the plugin checks for new tracks (in seconds)"}),a.React.createElement(m,{label:"Minimum Interval",subLabel:`The plugin will never check more frequently than ${L.MIN_UPDATE_INTERVAL} seconds`}))))}function hr(){fe.useProxy(k.plugin.storage);const[t,r]=a.React.useState(null),[n,s]=a.React.useState(!0),[c,l]=a.React.useState(0),[g,y]=a.React.useState(!1),v={name:"Bohemian Rhapsody",artist:"Queen",artists:["Queen"],album:"A Night at the Opera",image:null,nowPlaying:!0,duration:354,startTime:Math.floor(Date.now()/1e3)-120},C=function(T){return T?Array.isArray(T)?T.filter(function(U){return U&&typeof U=="string"}):T["#text"]?T["#text"].split(/[,;&]/).map(function(U){return U.trim()}).filter(function(U){return U.length>0}):typeof T=="string"?T.split(/[,;&]/).map(function(U){return U.trim()}).filter(function(U){return U.length>0}):["Unknown Artist"]:["Unknown Artist"]},D=function(T){return!T||T.length===0?"Unknown Artist":T.length===1?T[0]:T.length===2?`${T[0]} & ${T[1]}`:`${T.slice(0,-1).join(", ")} & ${T[T.length-1]}`};a.React.useEffect(function(){(async function(){if(!h("username")||!h("apiKey")){r(v),y(!0),s(!1);return}try{s(!0);const T=await(await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${h("username")}&api_key=${h("apiKey")}&format=json&limit=1`)).json();if(T.recenttracks&&T.recenttracks.track&&T.recenttracks.track.length>0){const U=T.recenttracks.track[0],ae=C(U.artist);let oe=180;try{const Te=ae[0]||"Unknown Artist",$=await(await fetch(`https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=${h("apiKey")}&artist=${encodeURIComponent(Te)}&track=${encodeURIComponent(U.name)}&format=json&username=${h("username")}`)).json();$.track&&$.track.duration&&(oe=Math.floor($.track.duration/1e3))}catch{console.log("Could not fetch track duration, using default")}r({name:U.name||"Unknown Track",artist:D(ae),artists:ae,album:U.album?.["#text"]||"Unknown Album",image:U.image?.[2]?.["#text"]||U.image?.[1]?.["#text"]||null,nowPlaying:U["@attr"]?.nowplaying==="true",duration:oe,startTime:U["@attr"]?.nowplaying==="true"?Math.floor(Date.now()/1e3)-60:null}),y(!1)}else r(v),y(!0)}catch(T){console.error("Failed to fetch preview data, using fallback:",T),r(v),y(!0)}finally{s(!1)}})()},[h("username"),h("apiKey")]),a.React.useEffect(function(){if(!t?.nowPlaying||!h("showTimestamp"))return;const T=setInterval(function(){if(t.startTime&&t.duration){const U=Math.floor(Date.now()/1e3)-t.startTime,ae=Math.min(U/t.duration,1);l(ae)}},1e3);return function(){return clearInterval(T)}},[t,h("showTimestamp")]);const W=function(T){const U=Math.floor(T/60),ae=Math.floor(T%60);return`${U}:${ae.toString().padStart(2,"0")}`},X=function(){let T="";if(h("showAlbumInTooltip")&&t?.album&&(T+=`on ${t.album}`),h("showDurationInTooltip")&&t?.duration){const U=` \u2022 ${W(t.duration)}`;T?T+=U:T=W(t.duration)}return T||"No tooltip text"},N=function(){return t?.duration?t.nowPlaying?{current:c*t.duration,total:t.duration,progress:c}:{current:t.duration*.3,total:t.duration,progress:.3}:{current:0,total:0,progress:0}},ne=h("listeningTo")?"Listening to":"Playing",q=h("appName","Music");if(n)return a.React.createElement(a.ReactNative.View,{style:B.container},a.React.createElement(a.ReactNative.View,{style:B.loadingContent},a.React.createElement(a.ReactNative.View,{style:B.loadingSpinner}),a.React.createElement(a.ReactNative.Text,{style:B.loadingText},"Loading preview...")));if(!t)return a.React.createElement(a.ReactNative.View,{style:B.container},a.React.createElement(a.ReactNative.Text,{style:B.centeredText},"Unable to load preview"));const J=N(),le=X();return a.React.createElement(a.ReactNative.View,{style:B.previewContainer},a.React.createElement(a.ReactNative.View,{style:B.header},a.React.createElement(a.ReactNative.Text,{style:B.activityType},ne," ",q),a.React.createElement(a.ReactNative.Text,{style:B.rpcPreviewText,numberOfLines:1},"RPC Preview")),a.React.createElement(a.ReactNative.View,{style:B.content},a.React.createElement(a.ReactNative.View,{style:B.albumArt},t.image?a.React.createElement(a.ReactNative.Image,{source:{uri:t.image},style:B.albumImage,resizeMode:"cover"}):a.React.createElement(a.ReactNative.Text,{style:B.musicIcon},"\u{1F3B5}")),a.React.createElement(a.ReactNative.View,{style:B.trackInfo},a.React.createElement(a.ReactNative.Text,{style:B.trackName,numberOfLines:1},t.name),a.React.createElement(a.ReactNative.Text,{style:B.artistName,numberOfLines:1},t.artist),h("showLargeText")&&le!=="No tooltip text"&&a.React.createElement(a.ReactNative.Text,{style:B.tooltipText,numberOfLines:1},le),h("showTimestamp")&&t.duration&&a.React.createElement(a.ReactNative.View,{style:B.progressContainer},a.React.createElement(a.ReactNative.Text,{style:B.timeText},W(J.current)),a.React.createElement(a.ReactNative.View,{style:B.progressBar},a.React.createElement(a.ReactNative.View,{style:[B.progressFill,{width:`${J.progress*100}%`}]})),a.React.createElement(a.ReactNative.Text,{style:B.timeText},W(J.total))))))}const B=a.ReactNative.StyleSheet.create({container:{backgroundColor:"#1e1f22",borderRadius:12,padding:16,marginHorizontal:10,marginBottom:16,borderWidth:1,borderColor:"#3a3c41",alignItems:"center",justifyContent:"center",minHeight:120},loadingContent:{alignItems:"center",justifyContent:"center"},loadingSpinner:{width:20,height:20,borderRadius:10,borderWidth:2,borderColor:"#5865f2",borderTopColor:"transparent",marginBottom:8},previewContainer:{backgroundColor:"#1e1f22",borderRadius:12,padding:16,marginHorizontal:10,marginBottom:16,borderWidth:1,borderColor:"#3a3c41"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:8},content:{flexDirection:"row",alignItems:"center"},albumArt:{width:80,height:80,backgroundColor:"#2b2d31",borderRadius:12,justifyContent:"center",alignItems:"center",marginRight:16,borderWidth:1,borderColor:"#40444b",overflow:"hidden",flexShrink:0},trackInfo:{flex:1,minWidth:0},progressContainer:{flexDirection:"row",alignItems:"center",gap:8,marginTop:6},progressBar:{flex:1,height:2,backgroundColor:"#2b2d31",borderRadius:3,overflow:"hidden"},progressFill:{height:2,backgroundColor:"#5865f2",borderRadius:3},loadingText:{color:"#949ba4",fontSize:14,fontWeight:"500"},centeredText:{color:"#949ba4",fontSize:14,fontWeight:"500",textAlign:"center"},activityType:{color:"#dbdee1",fontSize:14,fontWeight:"600",flex:1},rpcPreviewText:{color:"#80848e",fontSize:12,fontStyle:"italic",flexShrink:0},albumImage:{width:80,height:80,borderRadius:12},musicIcon:{color:"#80848e",fontSize:32},trackName:{color:"#ffffff",fontSize:16,fontWeight:"700",marginBottom:4},artistName:{color:"#b5bac1",fontSize:14,fontWeight:"500",marginBottom:4},tooltipText:{color:"#80848e",fontSize:12,fontStyle:"italic",marginBottom:6},timeText:{color:"#80848e",fontSize:11,fontWeight:"500",minWidth:35,textAlign:"center"}});function yr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(l){return l+1},0),r=h("listeningTo",L.DEFAULT_SETTINGS.listeningTo),n=h("showTimestamp",L.DEFAULT_SETTINGS.showTimestamp),s=function(){const l=!r;H("listeningTo",l),!l&&n&&H("showTimestamp",!1),t()},c=function(){r&&(H("showTimestamp",!n),t())};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(hr,null),a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"RPC Display Options"},a.React.createElement(Ae,{label:"Show as Listening",subLabel:"Display as 'Listening to' instead of 'Playing'",checked:r,onPress:s}),a.React.createElement(Ae,{label:"Show Tooltip Text",subLabel:"Show album name and track duration in Discord activity tooltip",checked:h("showLargeText",!0),onPress:function(){const l=h("showLargeText",!0);H("showLargeText",!l),t()}}),!r&&a.React.createElement(m,{label:"Timestamp Unavailable",subLabel:"Enable 'Show as Listening' to use timestamp feature",disabled:!0,dimmed:!0}),a.React.createElement(Ae,{label:"Show Timestamp",subLabel:"Display track progress and duration",checked:n,onPress:c,disabled:!r}),a.React.createElement(Ae,{label:"Show Album in Tooltip",subLabel:"Include album name in the tooltip text",checked:h("showAlbumInTooltip",!0),onPress:function(){const l=h("showAlbumInTooltip",!0);H("showAlbumInTooltip",!l),t()}}),a.React.createElement(Ae,{label:"Show Duration in Tooltip",subLabel:"Include track duration in the tooltip text",checked:h("showDurationInTooltip",!0),onPress:function(){const l=h("showDurationInTooltip",!0);H("showDurationInTooltip",!l),t()}}))))}function br(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(l){return l+1},0),[r,n]=a.React.useState(""),s=function(){if(!r.trim()){F.showToast("Please enter an app name",j.getAssetIDByName("Small"));return}const l=h("ignoreList",[]);l.includes(r.trim())?F.showToast("App already in ignore list",j.getAssetIDByName("Warning")):(H("ignoreList",[...l,r.trim()]),n(""),t(),F.showToast("App added to ignore list",j.getAssetIDByName("Check")))},c=function(l){const g=h("ignoreList",[]);H("ignoreList",g.filter(function(y){return y!==l})),t(),F.showToast("App removed from ignore list",j.getAssetIDByName("Check"))};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Add App to Ignore"},a.React.createElement(te,{spacing:4},a.React.createElement(ie,{placeholder:"Enter app name",value:r,onChange:n,isClearable:!0,onSubmitEditing:s,returnKeyType:"done"}))),a.React.createElement(Y,null,a.React.createElement(m,{label:"Add to Ignore List",subLabel:"Add the current app name to your ignore list",trailing:a.React.createElement(m.Arrow,null),onPress:s})),h("ignoreList",[]).length>0&&a.React.createElement(Y,{title:"Ignored Apps"},h("ignoreList",[]).map(function(l,g){return a.React.createElement(m,{key:g,label:l,trailing:a.React.createElement(a.ReactNative.TouchableOpacity,{onPress:function(){return c(l)},style:{padding:8,backgroundColor:"#ff4d4d",borderRadius:12,width:24,height:24,justifyContent:"center",alignItems:"center"}},a.React.createElement(a.ReactNative.Image,{source:j.getAssetIDByName("TrashIcon"),style:{width:14,height:14,tintColor:"#ffffff"}}))})})),a.React.createElement(Y,{title:"About Ignore List"},a.React.createElement(m,{label:"How it Works",subLabel:"When any app in your ignore list is active, your music status will be hidden"}),a.React.createElement(m,{label:"Detection",subLabel:"Apps are detected by their Discord activity name"}),a.React.createElement(m,{label:"Examples",subLabel:"Spotify, YouTube Music, Kizzy, Metrolist, echo"}))))}function vr(){fe.useProxy(k.plugin.storage);const[,t]=a.React.useReducer(function(r){return r+1},0);return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Logging Options"},a.React.createElement(kt,{label:"Verbose Logging",subLabel:"Enable detailed console logging for debugging",value:h("verboseLogging",L.DEFAULT_SETTINGS.verboseLogging),onValueChange:function(r){H("verboseLogging",r),t()}})),a.React.createElement(Y,{title:"Debug Information"},a.React.createElement(m,{label:"Console Logging",subLabel:"Logs are written to the browser/app console when verbose is enabled"}),a.React.createElement(m,{label:"Error Tracking",subLabel:"Connection errors and API failures are automatically logged"})),a.React.createElement(Y,{title:"Log Information"},a.React.createElement(m,{label:"API Calls",subLabel:"All API requests are logged when verbose is enabled"}),a.React.createElement(m,{label:"Track Updates",subLabel:"Song changes and RPC updates are logged"}),a.React.createElement(m,{label:"Error Details",subLabel:"Connection errors and retries are logged"}))))}k.plugin.storage.username??="",k.plugin.storage.apiKey??="",k.plugin.storage.appName??="Music",k.plugin.storage.timeInterval??=5,k.plugin.storage.showTimestamp??=!0,k.plugin.storage.listeningTo??=!0,k.plugin.storage.verboseLogging??=!1,k.plugin.storage.service??="lastfm",k.plugin.storage.librefmUsername??="",k.plugin.storage.librefmApiKey??="",k.plugin.storage.listenbrainzUsername??="",k.plugin.storage.listenbrainzToken??="",k.plugin.storage.traktUsername??="",k.plugin.storage.traktClientId??="",k.plugin.storage.traktAccessToken??="",k.plugin.storage.addToSidebar??=!0,k.plugin.storage.showLargeText??=!0,k.plugin.storage.ignoreList??=[],k.plugin.storage.showAlbumInTooltip??=!0,k.plugin.storage.showDurationInTooltip??=!0;const h=function(t,r){return k.plugin.storage[t]??r},H=function(t,r){return k.plugin.storage[t]=r},Ie=function(){function t(){he(this,t)}return ye(t,null,[{key:"getServiceDisplayName",value:function(r){switch(r){case"lastfm":return"Last.fm";case"librefm":return"Libre.fm";case"listenbrainz":return"ListenBrainz";case"trakt":return"Trakt";default:return"Unknown"}}},{key:"testService",value:async function(r){try{switch(r){case"lastfm":return await this.testLastFmConnection();case"librefm":return await this.testLibreFmConnection();case"listenbrainz":return await this.testListenBrainzConnection();case"trakt":return await this.testTraktConnection();default:return!1}}catch(n){return console.error(`Error testing ${r}:`,n),!1}}},{key:"testLastFmConnection",value:async function(){const r=h("username"),n=h("apiKey");if(!r||!n)return!1;try{return!(await(await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getinfo&user=${r}&api_key=${n}&format=json`)).json()).error}catch(s){return console.error("Last.fm connection test failed:",s),!1}}},{key:"testLibreFmConnection",value:async function(){const r=h("librefmUsername"),n=h("librefmApiKey");if(!r||!n)return!1;try{return!(await(await fetch(`https://libre.fm/2.0/?method=user.getinfo&user=${r}&api_key=${n}&format=json`)).json()).error}catch(s){return console.error("Libre.fm connection test failed:",s),!1}}},{key:"testListenBrainzConnection",value:async function(){const r=h("listenbrainzUsername"),n=h("listenbrainzToken");if(!r)return!1;try{const s={"Content-Type":"application/json"};return n&&(s.Authorization=`Token ${n}`),(await fetch(`https://api.listenbrainz.org/1/user/${r}/listen-count`,{headers:s})).status===200}catch(s){return console.error("ListenBrainz connection test failed:",s),!1}}},{key:"testTraktConnection",value:async function(){const r=h("traktUsername"),n=h("traktClientId"),s=h("traktAccessToken");if(!r||!n)return!1;try{const c={"Content-Type":"application/json","trakt-api-version":"2","trakt-api-key":n};return s&&(c.Authorization=`Bearer ${s}`),(await fetch(`https://api.trakt.tv/users/${r}`,{headers:c})).status===200}catch(c){return console.error("Trakt connection test failed:",c),!1}}}]),t}();function _t(){fe.useProxy(k.plugin.storage);const t=a.NavigationNative.useNavigation(),[,r]=a.React.useReducer(function(c){return c+1},0),n=h("service"),s=function(c){switch(c){case"lastfm":return h("username")&&h("apiKey")?"\u2705 Configured":"\u274C Missing credentials";case"librefm":return h("librefmUsername")&&h("librefmApiKey")?"\u2705 Configured":"\u274C Missing credentials";case"listenbrainz":return h("listenbrainzUsername")?"\u2705 Configured":"\u274C Missing username";case"trakt":return h("traktUsername")&&h("traktClientId")?"\u2705 Configured":"\u274C Missing credentials";default:return"\u2753 Unknown"}};return a.React.createElement(ge,{style:{flex:1},contentContainerStyle:{padding:10}},a.React.createElement(te,{spacing:8},a.React.createElement(Y,{title:"Active Service"},a.React.createElement(m,{label:"Current Service",subLabel:n?`Using: ${Ie.getServiceDisplayName(n)}`:"No service selected"}),["lastfm","librefm","listenbrainz","trakt"].map(function(c){return a.React.createElement(Ae,{key:c,label:Ie.getServiceDisplayName(c),subLabel:s(c),checked:n===c,onPress:function(){c!==n&&(H("service",c),r())}})})),a.React.createElement(Y,{title:"Service Configuration"},a.React.createElement(m,{label:"Last.fm Settings",subLabel:"Configure Last.fm credentials and options",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Last.fm Settings",render:sr})}}),a.React.createElement(m,{label:"Libre.fm Settings",subLabel:"Configure Libre.fm credentials and options",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Libre.fm Settings",render:lr})}}),a.React.createElement(m,{label:"ListenBrainz Settings",subLabel:"Configure ListenBrainz credentials and options",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"ListenBrainz Settings",render:fr})}}),a.React.createElement(m,{label:"Trakt Settings",subLabel:"Configure Trakt credentials and options",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Trakt Settings",render:gr})}})),a.React.createElement(Y,{title:"Plugin Configuration"},a.React.createElement(m,{label:"Display Settings",subLabel:"Customize app name and update interval",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Display Settings",render:pr})}}),a.React.createElement(m,{label:"RPC Customization",subLabel:"Customize Discord rich presence display options",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"RPC Customization",render:yr})}}),a.React.createElement(m,{label:"Ignore List",subLabel:"Configure apps that should hide your status",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Ignore List Settings",render:br})}}),a.React.createElement(m,{label:"Logging Settings",subLabel:"Configure logging and debugging options",trailing:a.React.createElement(m.Arrow,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Logging Settings",render:vr})}}),a.React.createElement(kt,{label:"Add to Sidebar",subLabel:"Show plugin in Discord settings",value:h("addToSidebar",!1),onValueChange:function(c){H("addToSidebar",c),r()}})),a.React.createElement(Y,{title:"About"},a.React.createElement(m,{label:"Multi Scrobbler",subLabel:"Show off your music status from multiple services"}),a.React.createElement(m,{label:"Author",subLabel:"kmmiio99o"}),a.React.createElement(m,{label:"Version",subLabel:"1.3.2"}))))}const{FormSection:mr,FormRow:ot}=Kt.Forms,{TableRowIcon:Er}=pe.findByProps("TableRowIcon"),Oe=window.bunny,Ct=Oe?.metro?.findByPropsLazy("getRootNavigationRef"),st=Oe?.metro?.findByPropsLazy("SETTING_RENDERER_CONFIG"),At=Oe?.metro?.findByPropsLazy("createList"),It=Oe?.metro?.findByNameLazy("SettingsOverviewScreen",!1);function wr({tabs:t}){const r=a.NavigationNative.useNavigation();return a.React.createElement(ot,{label:t.title(),leading:a.React.createElement(ot.Icon,{source:t.icon}),trailing:a.React.createElement(a.React.Fragment,{},[t.trailing?t.trailing():null,a.React.createElement(ot.Arrow,{key:"arrow"})]),onPress:function(){const n=t.page;r.navigate("VendettaCustomPage",{title:t.title(),render:function(){return a.React.createElement(n)}})}})}function Rr(t,r){try{const n=Oe?.metro?.findByPropsLazy(["renderTitle","sections"],!1);if(!n){console.warn("[Multi Scrobbler] patchPanelUI: Target module not found");return}r.push(Ve.after("default",n,function(s,c){const l=tt.findInReactTree(c.props.children,function(g){return g.type?.name==="UserSettingsOverview"});l&&r.push(Ve.after("render",l.type.prototype,function(g,y){const v=tt.findInReactTree(y.props.children,function(C){return C?.children?.[1]?.type===mr})?.children;if(v){const C=v.findIndex(function(D){return["BILLING_SETTINGS","PREMIUM_SETTINGS"].includes(D?.props?.label)});v.splice(-~C||4,0,a.React.createElement(wr,{key:t.key,tabs:t}))}}))},!0))}catch(n){k.logger.info("Panel UI patch failed graciously \u{1F494}",n)}}function Tr(t,r){if(!st||!Ct){console.warn("[Multi Scrobbler] Missing required constants for tabs UI patch");return}const n={[t.key]:{type:"pressable",title:t.title,icon:t.icon,IconComponent:t.icon&&function(){return a.React.createElement(Er,{source:t.icon})},usePredicate:t.predicate,useTrailing:t.trailing,onPress:function(){const l=Ct.getRootNavigationRef(),g=t.page;l.navigate("VendettaCustomPage",{title:t.title(),render:function(){return a.React.createElement(g)}})},withArrow:!0}};let s=st.SETTING_RENDERER_CONFIG;Object.defineProperty(st,"SETTING_RENDERER_CONFIG",{enumerable:!0,configurable:!0,get:function(){return{...s,...n}},set:function(l){return s=l}});const c=Symbol("pinToSettings meow meow");try{if(!At)return;r.push(Ve.after("createList",At,function(l,g){if(!l[0][c]){l[0][c]=!0;const[y]=l,v=y.sections?.find(function(C){return["Bunny","Revenge","Kettu","Vencore","ShiggyCord"].some(function(D){return C.label===D&&C.title===D})});v?.settings&&(v.settings=[...v.settings,t.key])}}))}catch{if(!It)return;r.push(Ve.after("default",It,function(l,g){if(!l[0][c]){l[0][c]=!0;const{sections:y}=tt.findInReactTree(g,function(C){return C.props?.sections}).props,v=y?.find(function(C){return["Bunny","Revenge","Kettu","Vencore","ShiggyCord"].some(function(D){return C.label===D&&C.title===D})});v?.settings&&(v.settings=[...v.settings,t.key])}}))}}function Sr(t){const r=[];let n=!1;const s=t.predicate||function(){return!0};return t.predicate=function(){return n?!1:s()},Rr(t,r),Tr(t,r),r.push(function(){return n=!0}),function(){for(const c of r)c()}}function Lt(){if(!k.plugin.storage.addToSidebar)return console.log("[Multi Scrobbler] Sidebar disabled in settings"),function(){};console.log("[Multi Scrobbler] Patching sidebar using custom patchSettingsPin...");try{const t=Sr({key:"LastFmScrobbler",icon:j.getAssetIDByName("MusicIcon"),title:function(){return"Multi Scrobbler"},predicate:function(){return k.plugin.storage.addToSidebar===!0},page:_t});return console.log("[Multi Scrobbler] Successfully patched sidebar"),t}catch(t){return console.error("[Multi Scrobbler] Failed to patch sidebar:",t),function(){}}}try{console.log("[Scrobble Plugin] module loaded (index.tsx)"),function(){try{const t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:void 0;if(!t)return;t.__scrobbleBridge=t.__scrobbleBridge||{},t.__scrobbleBridge.forceOnLoad=function(){try{const r=t.__scrobble_plugin||typeof module<"u"&&module.exports&&module.exports.default||null;if(r&&typeof r.onLoad=="function")try{r.onLoad(),console.log("[Scrobble Plugin] bridge: onLoad invoked")}catch(n){console.error("[Scrobble Plugin] bridge: onLoad threw an error:",n)}else console.warn("[Scrobble Plugin] bridge: plugin export or onLoad not available")}catch(r){console.error("[Scrobble Plugin] bridge: failed to invoke onLoad:",r)}},t.__scrobbleBridge.inspect=function(){try{return t.__scrobble_plugin||typeof module<"u"&&module.exports&&module.exports.default||null}catch(r){return console.error("[Scrobble Plugin] bridge.inspect error:",r),null}},t.__scrobbleBridge.tryReload=function(){try{if(typeof require<"u"&&require.cache){try{const r=require.resolve&&require.resolve("./index.tsx");r&&require.cache[r]&&delete require.cache[r]}catch{}try{const r=require("./index.tsx"),n=r&&r.__esModule&&typeof r.default<"u"?r.default:r;return t.__scrobble_plugin=n,console.log("[Scrobble Plugin] bridge: reloaded plugin module"),n}catch(r){return console.error("[Scrobble Plugin] bridge: reload failed:",r),null}}else return console.warn("[Scrobble Plugin] bridge.tryReload not supported in this runtime"),null}catch(r){return console.error("[Scrobble Plugin] bridge.tryReload error:",r),null}}}catch(t){try{console.error("[Scrobble Plugin] Failed to install debug bridge:",t)}catch{}}}()}catch(t){try{console.error("[Scrobble Plugin] Top-level init error:",t)}catch{}}(function(){try{const t=typeof globalThis<"u"?globalThis:{};if(t&&!t.__scrobble_unhandled_rejection_installed){const r=function(n){try{const s=n&&(n.reason??n)?n.reason??n:n;console.error("[Scrobble Plugin] Unhandled rejection:",s)}catch{console.error("[Scrobble Plugin] Unhandled rejection (unknown format)",n)}};if(t&&typeof t.addEventListener=="function")try{t.addEventListener("unhandledrejection",r),t.__scrobble_unhandled_rejection_installed=!0;return}catch(n){console.error("[Scrobble Plugin] Failed to register via globalThis.addEventListener:",n)}if(typeof globalThis.window<"u"){const n=globalThis.window;if(n&&typeof n.addEventListener=="function")try{n.addEventListener("unhandledrejection",r),t.__scrobble_unhandled_rejection_installed=!0;return}catch(s){console.error("[Scrobble Plugin] Failed to register via window.addEventListener:",s)}else if(n)try{if(typeof n.onunhandledrejection>"u"){n.onunhandledrejection=function(s){return r(s)},t.__scrobble_unhandled_rejection_installed=!0;return}}catch(s){console.error("[Scrobble Plugin] Failed to assign window.onunhandledrejection:",s)}}try{const n=globalThis.process;if(n&&typeof n.on=="function"){n.on("unhandledRejection",function(s){return r({reason:s})}),t.__scrobble_unhandled_rejection_installed=!0;return}}catch{}t.__scrobble_unhandled_rejection_installed=!0}}catch(t){try{console.error("[Scrobble Plugin] Error while installing unhandled rejection handler:",t)}catch{}}})();let De;function kr(){if(!De)try{De=setInterval(function(){console.log("[Scrobble Plugin] Heartbeat (alive)")},6e4)}catch(t){console.error("[Scrobble Plugin] Failed to start heartbeat:",t)}}function _r(){if(De)try{clearInterval(De)}catch(t){console.error("[Scrobble Plugin] Failed to clear heartbeat:",t)}finally{De=void 0}}const K={pluginStopped:!1,lastActivity:void 0,updateInterval:void 0,lastTrackUrl:void 0},ct=[];let me;const Pt=L.DEFAULT_SETTINGS;for(const t of Object.keys(Pt))try{k.plugin.storage[t]=k.plugin.storage[t]??Pt[t]}catch(r){console.error("[Scrobble Plugin] Failed to initialize default setting",t,r)}try{k.plugin.storage.addToSidebar??=!1}catch{}const p=new Proxy(k.plugin.storage,{get(t,r){return t[r]},set(t,r,n){return t[r]=n,!0}});let Ke=0;const lt=3,Cr=5e3,x=function(...t){return console.log("[Scrobble Plugin]",...t)},re=function(...t){return console.error("[Scrobble Plugin] Error:",...t)};async function Me(){try{await ar(),Ke=0,x("Plugin initialized successfully")}catch(t){re("Initialization failed:",t),Ke++,Ke<lt?(x(`Retrying connection (${Ke}/${lt})...`),setTimeout(Me,Cr)):re(`Failed to connect after ${lt} attempts`)}}async function Ar(){if(!p.service){x("No service selected. Please configure a service in plugin settings.");return}let t="Unknown";try{t=be.getCurrentService().getServiceName()}catch(s){re("Failed to determine current service name:",s)}const r=p.service;let n=!1;switch(r){case"lastfm":n=!!(p.username&&p.apiKey);break;case"librefm":n=!!(p.librefmUsername&&p.librefmApiKey);break;case"listenbrainz":n=!!p.listenbrainzUsername;break;case"trakt":n=!!(p.traktUsername&&p.traktClientId);break}if(!n){re(`Missing credentials for ${t}. Please configure in plugin settings.`);return}if(x(`Starting with ${t}...`),ht?.getCurrentUser())x("Discord is already connected, initializing immediately..."),await Me();else{x("Waiting for Discord connection...");const s=function(){try{ht?.getCurrentUser()&&(x("Discord connection established"),Me(),a.FluxDispatcher.unsubscribe("CONNECTION_OPEN",s))}catch(c){re("Error while waiting for Discord connection:",c)}};try{a.FluxDispatcher.subscribe("CONNECTION_OPEN",s)}catch(c){re("Failed to subscribe to CONNECTION_OPEN:",c)}}}const Nt={onLoad(){x("Plugin loading..."),K.pluginStopped=!1;try{kr(),x("Heartbeat started")}catch(t){re("Failed to start heartbeat:",t)}if(!p.service)x("No service configured. Please select a service in plugin settings.");else try{const t=be.getCurrentService().getServiceName();x(`Configuration: Service=${t}, Update Interval=${p.timeInterval}s, Verbose=${p.verboseLogging}`)}catch(t){re("Failed to read service configuration:",t)}try{me=Lt(),ct.push(function(){if(me){try{me()}catch{}me=void 0}})}catch(t){x("Sidebar setup failed:",t)}try{Ar(),x("onLoad complete - validateAndInitialize triggered")}catch(t){re("validateAndInitialize threw an error:",t)}},onUnload(){x("Plugin unloading..."),K.pluginStopped=!0;try{_r(),x("Heartbeat stopped")}catch(t){re("Failed to stop heartbeat:",t)}ct.forEach(function(t){try{t()}catch{}}),ct.length=0;try{it()}catch(t){re("Error while stopping plugin manager:",t)}x("Plugin unloaded")},async onSettingsUpdate(t){const r=p.service,n=t.service,s=p.addToSidebar,c=t.addToSidebar;try{Object.assign(p,t)}catch(l){re("Failed to apply new settings:",l)}if(x("Settings updated:",Object.keys(t||{})),s!==c){if(c)try{me=Lt(),x("Sidebar enabled")}catch(l){x("Failed to enable sidebar:",l)}else if(me){try{me()}catch(l){re("Failed to unpatch sidebar:",l)}me=void 0,x("Sidebar disabled")}}if(r!==n&&n){x(`Service changed from ${r||"none"} to ${n}`);try{await ir(n)}catch(l){re("Failed to switch service:",l)}}else if(!K.pluginStopped&&p.service)x("Restarting with updated settings..."),await Me();else if(!p.service){x("Service unselected, stopping plugin...");try{it()}catch(l){re("Error while stopping due to service unselected:",l)}}},onDiscordReconnect(){K.pluginStopped||(x("Discord reconnected, reinitializing plugin..."),Me())},settings:_t};try{const t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:void 0;if(t)try{t.__scrobble_plugin=Nt,t.__scrobbleBridge&&typeof t.__scrobbleBridge.inspect=="function"&&console.log("[Scrobble Plugin] global plugin export attached for inspection")}catch(r){console.error("[Scrobble Plugin] Failed to assign global plugin export:",r)}}catch{}return $e.currentSettings=p,$e.default=Nt,$e.pluginState=K,Object.defineProperty($e,"__esModule",{value:!0}),$e})({},vendetta,vendetta.metro.common,vendetta.metro,_call_super,vendetta.storage,vendetta.ui.toasts,vendetta.ui.assets,vendetta.patcher,vendetta.ui.components,vendetta.utils);
